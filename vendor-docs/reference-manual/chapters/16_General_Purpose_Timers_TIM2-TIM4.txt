WB32FQ95xx Reference Manual

16.

General-Purpose Timers (TIM2-TIM4)

16.1.

Overview
The general-purpose timer modules (TIM2-TIM4) is a four-channel timer that supports both
input capture and output compare. They can generate PWM signals to control motor or be
used for power management applications. The general-purpose timer has a 20-bit counter
that can be used as an unsigned counter.
In addition, the general-purpose timers can be programmed and be used for counting, their
external events can be used to drive other timers.
The general-purpose timers (TIM2-TIM4) are completely independent with each other, but
they may be synchronized to provide a larger timer with their counters increment in unison.

16.2.

Characteristics
⚫

Total channel number: 4.

⚫

Counter width: 20bit.

⚫

Source of counter clock is select-able:
◼

internal clock

◼

internal trigger

◼

external input

◼

external trigger

⚫

Multiple counter modes: count up, count down, count up/down.

⚫

Quadrature Decoder: used to track motion and determine both rotation direction and
position.

⚫

Hall sensor: for 3-phase motor control.

⚫

Programmable prescaler: 16 bit. The factor can be changed on the go.

⚫

Each channel is user-configurable:
◼

input capture mode

◼

output compare mode

◼

programmable PWM mode

◼

single pulse mode

⚫

Auto reload function.

⚫

Interrupt output or DMA request on:

⚫

Doc ID 2905025

◼

update

◼

trigger event

◼

compare/capture event

Daisy chaining of timer modules allows a single timer to initiate multiple timers .

Rev01

216

WB32FQ95xx Reference Manual

16.3.

⚫

Timer synchronization allows selected timers to start counting on the same clock cycle.

⚫

Timer Master/Slave mode controller.

Block diagram
The figure 17-1 provides the details of the internal configuration of the general-purpose timer.
Figure 16-1. General-purpose timer block diagram

16.4.

Function overview

16.4.1.

Clock selection
The general-purpose timer has the capability of being clocked by either the TIMER_CK or an
alternate clock source controlled by SMS (TIMx_SMCR bit [2:0]).

Doc ID 2905025

Rev01

217

WB32FQ95xx Reference Manual

⚫

SMS [2:0] == 3’b000. Internal clock CK_TIMER is selected as timer clock source which
is from module RCC.

The default clock source is the CK_TIMER for driving the counter prescaler when the slave
mode is disabled (SMS [2:0] == 3’b000). When the CEN is set, the CK_TIMER will be divided
by PSC value to generate PSC_CLK.
In this mode, the TIMER_CK, which drives counter’s prescaler to count, is equal to
CK_TIMER which is from RCC.
If the slave mode controller is enabled by setting SMS [2:0] in the TIMx_SMCR register to an
available value including 0x1, 0x2, 0x3 and 0x7, the prescaler is clocked by other clock
sources selected by the TS[2:0] in the TIMx_SMCR register , details as follows. When the
slave mode selection bits SMS[2:0] are set to 0x4, 0x5 or 0x6, the internal clock
TIMER_CK is the counter prescaler driving clock source.
Figure 16-2. Normal mode, internal clock divided by 1

⚫

SMS[2:0] == 3’b111 (external clock mode 1). External input pin is selected as timer clock
Source.

The TIMER_CK, which drives counter’s prescaler to count, can be triggered by the event of
rising or falling edge on the external pin TIMx_CH1/TIMx_CH2. This mode can be selected
by setting SMS[2:0] to 0x7 and the TS[2:0] to 0x4, 0x5 or 0x6.
And, the counter prescaler can also be driven by rising edge on the internal trigger input pin
ITR0/1/2/3. This mode can be selected by setting SMS [2:0] to 0x7 and the TS [2:0] to 0x0,
0x1, 0x2 or 0x3.
⚫

ECE== 1’b1 (external clock mode 2). External input is selected as timer clock source
(ETR).

The TIMER_CK, which drives counter’s prescaler to count, can be triggered by the event of
rising or falling edge on the external pin ETR. This mode can be selected by setting the ECE
bit in the TIMx_SMCR register to 1. The other way to select the ETR signal as the clock
source is to set the SMS [2:0] to 0x7 and the TS [2:0] to 0x7 respectively. Note that the ETR
signal is derived from the ETR pin sampled by a digital filter. When the ETR signal is selected
as clock source, the trigger controller including the edge detection circuitry will generate a
clock pulse on each ETR signal rising edge to clock the counter prescaler.

Doc ID 2905025

Rev01

218

WB32FQ95xx Reference Manual

16.4.2.

Prescaler
The prescaler can divide the timer clock (TIMER_CK) to a counter clock (PSC_CLK) by any
factor between 1 and 65536. It is controlled by prescaler register (TIMx_PSC) which can be
changed on the go but is taken into account at the next update event.
Figure 16-3. Counter timing diagram with prescaler division change from 1 to 4

16.4.3.

Up counting mode
In this mode, the counter counts up continuously from 0 to the counter-reload value, which is
defined in the TIMx_ARR register, in a count-up direction. Once the counter reaches the
counter reload value, the counter restarts from 0. If the repetition counter is set, the update
events will be generated after (TIMx_RCR+1) times of overflow. Otherwise the update event
is generated each time when overflows. The counting direction bit DIR in the TIMx_CR1
register should be set to 0 for the up counting mode.
Whenever, if the update event software trigger is enabled by setting the UG bit in the
TIMx_EGR register, the counter value will be initialized to 0 and generates an update event.
If set the UDIS bit in TIMx_CR1 register, the update event is disabled.
When an update event occurs, all the registers (repetition counter, auto reload register,
prescaler register) are updated.
The following figures show some examples of the counter behavior for different clock
prescaler factor when TIMx_ARR=0x36.
Figure 16-4. Up-counter timechart, PSC=0

Doc ID 2905025

Rev01

219

WB32FQ95xx Reference Manual

Figure 16-5. Up-counter timechart, PSC=1

Figure 16-6. Up-counter timechart, PSC=3

Figure 16-7. Up-counter timechart, PSC=N

Doc ID 2905025

Rev01

220

WB32FQ95xx Reference Manual

Figure 16-8. Up-counter timechart, change TIMx_ARR on the go

16.4.4.

Down counting mode
In this mode, the counter counts down continuously from the counter-reload value, which is
defined in the TIM1_ARR register, to 0 in a count-down direction. Once the counter reaches
to 0, the counter restarts to count again from the counter-reload value. If the repetition
counter is set, the update event will be generated after (TIMx_RCR+1) times of underflow.
Otherwise the update event is generated each time when underflows. The counting direction
bit DIR in the TIMx_CR1 register should be set to 1 for the down-counting mode.
When the update event is set by the UG bit in the TIMx_EGR register, the counter value will
be initialized to the counter-reload value and generates an update event.
If set the UDIS bit in TIMx_CR1 register, the update event is disabled.
When an update event occurs, all the registers (repetition counter, auto reload register,
prescaler register) are updated.
The following figures show some examples of the counter behavior in different clock
frequencies when TIMx_ARR=0x36.

Doc ID 2905025

Rev01

221

WB32FQ95xx Reference Manual

Figure 16-9. Down-counter timechart, PSC=0

Figure 16-10. Down-counter timechart, PSC=1

Figure 16-11. Down-counter timechart, PSC=3

Doc ID 2905025

Rev01

222

WB32FQ95xx Reference Manual

Figure 16-12. Down-counter timechart, PSC=N

Figure 16-13. Down-counter timechart, change TIMx_ARR on the go (APRE=0)

16.4.5.

Center-aligned counting mode
In the center-aligned counting mode, the counter counts up from 0 to the counter-reload
value and then counts down to 0 alternatively. The Timer module generates an overflow
event when the counter counts to the counter-reload value subtract 1 in the up-counting
direction and generates an underflow event when the counter counts to 1 in the
down-counting direction. The counting direction bit DIR in the TIMx_CR1 register is
read-only and indicates the counting direction when in the center-aligned mode. The
counting direction is updated by hardware automatically.
Setting the UG bit in the TIMx_EGR register will initialize the counter value to 0 and

Doc ID 2905025

Rev01

223

WB32FQ95xx Reference Manual

generates an update event irrespective of whether the counter is counting up or down in the
center-align counting mode.
The UIF bit in the TIMx_SR register can be set to 1 either when an underflow event or an
overflow event occurs. While the CCxIF bit is associated with the value of CMS in TIMx_CR1.
Refer to Figure 17-14 for the details.
If set the UDIS bit in the TIMx_CR1 register, the update event is disabled.
When an update event occurs, all the registers (repetition counter, auto-reload register,
prescaler register) are updated.
The figures below show some examples of the counter behavior for different clock
frequencies.
Figure 16-14. Center-aligned counter timechart, PSC=0

Figure 16-15. Center-aligned counter timechart, PSC=1

Doc ID 2905025

Rev01

224

WB32FQ95xx Reference Manual

Figure 16-16. Center-aligned counter timechart, PSC=3

Figure 16-17. Center-aligned counter timechart, PSC=N

Figure 16-18. Center-aligned counter timechart, update event with ARPE=1 (counter underflow)

Doc ID 2905025

Rev01

225

WB32FQ95xx Reference Manual

Figure 16-19. Center-aligned counter timechart, update event with ARPE=1 (counter overflow)

16.4.6.

Capture/compare channels
The general-purpose timer has four independent channels which can be used as capture
inputs or compare match outputs. Each channel is built around a channel capture compare
register including an input stage, channel controller and an output stage.
⚫

Input capture mode

Capture mode allows the channel to perform measurements such as pulse timing, frequency,
period, duty cycle and so on. The input stage consists of a digital filter, a channel polarity
selection, edge detection and a channel prescaler. When a selected edge occurs on the
channel input, the current value of the counter is captured into the TIMx_CCRx register, at
the same time the CCxIF bit is set and the channel interrupt is generated if enabled by CCxIE
= 1.
Figure 16-20. Input capture logic

One of channels’ input signals (TIx) can be chosen from the TIMx_CHx signal or the
Excusive-OR function of the TIMx_CH1, TIMx_CH2 and TIMx_CH3 signals. First, the
channel input signal (TIx) is synchronized to TIMER_CK domain, and then sampled by a
digital filter to generate a filtered input signal. Then through the edge detector, the rising and
falling edge are detected. You can select one of them by CCxP. One more selector is for the
other channel and trig, controlled by CCxS. The IC_prescaler make several the input event
generate one effective capture event. On the capture event, CCRx will restore the value of
Counter.
So the process can be divided to several steps as below:
Step1:

Doc ID 2905025

Filter configuration. (ICxF in TIMx_CCMR1)

Rev01

226

WB32FQ95xx Reference Manual

Based on the input signal and requested signal quality, configure compatible ICxF.
Step2:

Edge selection. (CCxP/CCxNP in TIMx_CCER)
Rising or falling edge, choose one by CCxP/CCxNP.

Step3:

Capture source selection. (CCxS in TIMx_CCMR1)
As soon as you select one input capture source by CCxS, you have set the channel
to input mode (CCxS!=0x0) and TIMx_CCRx cannot be written any more.

Step4:

Interrupt enable. (CCxIE and CCxDE in TIMx_DIER)
Enable the related interrupt enable; you can got the interrupt and DMA request.

Step5:

Capture enables. (CCxE in TIMx_CCER)

Result: when your wanted input signal is got, TIMx_CCRx will be set by counter’s value.
And CCxIF is also asserted. If the CCxIF has been high, the CCxOF will also be asserted.
The interrupt and DMA request will be asserted based on the configuration of CCxIE and
CCxDE in TIMx_DIER.
Direct generation: if you want to generate a DMA request or Interrupt, you can set CCxG by
software directly.
The input capture mode can also be used for pulse width measurement from signals on the
TIMx_CHx pins. For example, PWM signal connect to TI1 input. Select Channel 1 capture
signals to TI1 by setting CC1S to 2’b01 in the channel control register (TIMx_CCMR1) and
set capture on rising edge. Select Channel 2 capture signal to TI1 by setting CC2S to 2’b10
in the channel control register (TIMx_CCMR1) and set capture on falling edge. The counter
set to restart mode and restart on Channel 1 rising edge. Then the TIMx_CCR1 can measure
the PWM period and the TIMx_CCR2 can measure the PWM duty.
⚫

Output compare mode

In output compare mode, the TIMx can generate timed pulses with programmable position,
polarity, duration and frequency. When the counter matches the value in the CCRx register of
an output compare channel, the channel (n) output can be set, cleared, or toggled based on
OCxM. When the counter reaches the value in the CCRx register, the CCxIF bit is set and
the channel (n) interrupt is generated if CCxIE = 1. And the DMA request will be asserted, if
CCxDE = 1.
So the process can be divided to several steps as below:
Step1:

Clock Configuration. Such as clock source, clock prescaler and so on.

Step2:

Compare mode configuration.
* Set the shadow enable mode by OCxPE
* Set the output mode (Set/Clear/Toggle) by OCxM.
* Select the active high polarity by CCxP/CCxNP
* Enable the output by CCxE

Step3:

Interrupt/DMA-request enables configuration by CCxIE/CCxDE.

Step4:

Compare output timing configuration by TIMx_ARR and TIMx_CCRx
About the CCRx; you can change it on the go to meet the waveform you expected.

Step5:

Doc ID 2905025

Start the counter by setting CEN.

Rev01

227

WB32FQ95xx Reference Manual

The timechart below shows the output compare mode in detail.

Figure 16-21. Output-compare mode, toggle on OC1

16.4.7.

PWM mode
In the output PWM mode (by setting the OCxM bits to 3’b110 (PWM mode1) or to 3’b
111(PWM mode2), the channel can generate PWM waveform according to the TIMx_ARR
registers and TIMx_CCRx registers.
Based on the counter mode, we can also divide PWM into EAPWM (Edge aligned PWM) and
CAPWM (Centre aligned PWM).
The EAPWM period is determined by TIMx_ARR and duty cycle is determined by
TIMx_CCRx. The Figure below shows the EAPWM output and interrupts waveform.

Figure 16-22. EAPWM waveforms (ARR=8)

The CAPWM period is determined by 2*TIMx_ARR, and duty cycle is by
2*TIMx_CCRx. The figure below shows the CAPWM output and interrupts waveform.

Doc ID 2905025

Rev01

228

WB32FQ95xx Reference Manual

Figure 16-23. CAPWM waveforms (ARR=8)

If TIMx_CCRx is greater than TIMx_ARR, the output will be always active under PWM
mode1 (OCxM = 3’b110).
And if TIMx_CCRx is equal to zero, the output will be always inactive under PWM mode1
(OCxM = 3’b110)

16.4.8.

Channel output reference signal
When the TIMx is used in the compare match output mode, the OxCPRE signal (Channel x
Output prepare signal) is defined by setting the OCxM filed. The OxCPRE signal has several
types of output function. These include, keeping the original level by setting the OCxM field
to 0x00, set to 1 by setting the OCxM field to 0x01, set to 0 by setting the OCxM field to 0x02
or signal toggle by setting the OCxM field to 0x03 when the counter value matches the
content of the TIMx_CCRx register.
The PWM mode 1 and PWM mode 2 outputs are also another kind of OxCPRE output which
is setup by setting the OCxM field to 0x06/0x07. In these modes, the OxCPRE signal level is
changed according to the counting direction and the relationship between the counter value
and the TIMx_CCRx content. With regard to a more detail description refer to the relative bit
definition.
Another special function of the OxCPRE signal is a forced output which can be achieved by
setting the OCxM field to 0x04/0x05. Here the output can be forced to an inactive/active
level irrespective of the comparison condition between the counter and the TIMx_CCRx
values.
The OxCPRE signal can be forced to 0 when the ETRF signal is derived from the external

Doc ID 2905025

Rev01

229

WB32FQ95xx Reference Manual

ETR pin and when it is set to a high level by setting the OCxCE bit to 1 in
the TIMx_CCMR1 register. The OxCPRE signal will not return to its active level until the next
update event occurs.

16.4.9.

Quadrature decoder
The quadrature decoder function uses two quadrature inputs TI1 and TI2 derived from the
TIMx_CH1 and TIMx_CH2 pins respectively to interact to generate the counter value. The
DIR bit is modified by hardware automatically during each input source transition. The input
source can be either TI1 only, TI2 only or both TI1 and TI2, the selection mode by setting the
SMS[2:0] to 0x01, 0x02 or 0x03. The mechanism for changing the counter direction is shown
in the following table. The quadrature decoder can be regarded as an external clock with a
directional selection. This means that the counter counts continuously in the interval between
0 and the counter-reload value. Therefore, users must configure the TIMx_ARR register
before the counter starts to count.
Table 16-1. Counting direction versus encoder signals
TI1FP1

Counting mode

TI1 only
counting
TI2 only
counting

TI1 and TI2
counting

TI2FP2

Level
Rising

Falling

Rising

Falling

TI2FP2=High

Down

Up

-

-

TI2FP2=Low

Up

Down

-

-

TI1FP1=High

-

-

Up

Down

TI1FP1=Low

-

-

Down

Up

TI2FP2=High

Down

Up

X

X

TI2FP2=Low

Up

Down

X

X

TI1FP1=High

X

X

Up

Down

TI1FP1=Low

X

X

Down

Up

Note:"-" means "no counting"; "X" means impossible.
Figure 16-24. Example of counter operation in encoder interface mode

Doc ID 2905025

Rev01

230

WB32FQ95xx Reference Manual

Figure 16-25. Example of encoder interface mode with CI1FE0 polarity inverted

16.4.10.

Hall sensor function
Hall sensor is generally used to control BLDC Motor; general-purpose timer can support this
function.
Figure 17-27 shows how to connect. And we can see we need two timers. First TIMER
（General purpose TIMER） should accept three Rotor Position signals from Motor.

in

Each of the 3 sensors provides a pulse that applied to an input capture pin, can then be
analyzed and both speed and position can be deduced.
By the internal connection such as TRGO- ITIx, TIMER_in and TIMER_out can be connected.
TIMER_out will generate PWM signal to control BLDC motor’s speed based on the ITRx.
Then, the feedback circuit is finished, also you change configuration to fit your request.
About the TIMER_in, it need have input XOR function, so you can choose from Advanced
TIMER.
And TIMER_out need have functions of complementary and Dead-time, so only
general-purpose timer can be chosen. Else, based on the timers’ internal connection
relationship, pair’s timers can be selected. For example:
TIMER_in (TIMER2) -> TIMER_out (Timer1 ITR1)
And so on.
After getting appropriate timers combination, and wire connection, we need to configure
timers. Some key settings include:
⚫

Enable XOR by setting TI1S, then, each of input signal change will make the TI1 toggle.
CCR1 will record the value of counter at that moment.

⚫

Enable ITRx connected to commutation function directly by setting CCUS and CCPC.

⚫

Configuration PWM parameter based on your request.

Doc ID 2905025

Rev01

231

WB32FQ95xx Reference Manual

Figure 16-26. Hall sensor is used to BLDC motor

Figure 16-27. Hall sensor timing between two timers

Slave controller
The TIMx can be synchronized with a trigger in several modes including the restart mode,
the pause mode and the event mode which is selected by the SMS [2:0] in the TIMx_SMCR
register. The trigger input of these modes can be selected by the TS [2:0] in the TIMx_SMCR
register.
Doc ID 2905025

Rev01

232

WB32FQ95xx Reference Manual

16.4.11.

Single pulse mode
Single pulse mode is opposite to the repetitive mode, which can be enabled by setting OPM
in TIMx_CR1. When you set OPM, the counter will be clear and stop when the next update
event automatically. In order to get pulse waveform, you can set the TIMx to PWM mode or
compare by OCxM.
Once the timer is set to operate in the single pulse mode, it is not necessary to set the timer
enable bit CEN in the TIMx_CR1 register to 1 to enable the counter. The trigger to generate a
pulse can be sourced from the trigger signals edge or by setting the CEN bit to 1 using
software. Setting the CEN bit to 1 or a trigger from the trigger signals edge can generate a
pulse and then keep the CEN bit at a high state until the update event occurs or the CEN bit
is written to 0 by software. If the CEN bit is cleared to 0 using software, the counter will be
stopped and its value held. If the CEN bit is automatically cleared to 0 by a hardware update
event, the counter will be reinitialized.
In the single pulse mode, the trigger active edge which sets the CEN bit to 1 will enable the
counter. However, there exist several clock delays to perform the comparison result between
the counter value and the TIMx_CCRx value. In order to reduce the delay to a minimum
value, the user can set the OCxFE bit in each TIMx_CCMR1/1 register. After a trigger rising
occurs in the single pulse mode, the OxCPRE signal will immediately be forced to the state
which the OxCPRE signal will change to, as the compare match event occurs without taking
the comparison result into account. The OCxFE bit is available only when the output channel
is configured to operate in the PWM1 or PWM2 output mode and the trigger source is
derived from the trigger signal.
Figure 16-28. Single pulse mode, TIMx_CCRx = 0x04, TIMx_ARR=0x60

16.4.12.

Timers interconnection
The timers can be internally connected together for timer chaining or synchronization. Please
refer to section 16.4.14 for detail info.

16.4.13.

Timer DMA mode
If one of the DMA request event coming, TIMx will send DMA requests to DMAC. The user
can configure DMAC properly and read/write TIMx SFRs under the control of DMA. Please
refer to DMAC related chapters for details.

Doc ID 2905025

Rev01

233

WB32FQ95xx Reference Manual

16.4.14.

Timer debug mode
When the Cortex™-M3 is halted, and the DBG_TIMx_STOP configuration bit in
DBGMCU_CR register is set to 1, the TIMx counter stops.

16.5.

Register definition

16.5.1.

Control register 1 (TIMx_CR1)
Address offset: 0x00
Reset value: 0x0000

Bits

Fields

RW

31:10

Reserved

R

9:8

CKD[1:0]

RW

7

ARPE

RW

6:5

CMS[1:0]

RW

4

DIR

RW

3

OPM

Rw

2

URS

RW

Doc ID 2905025

Descriptions
Must be kept at reset value
Clock division
The CKD bits can be configured by software to specify division ratio between the
timer clock (TIMER_CK) and the dead-time and sampling clock (DTS), which is
used by the dead-time generators and the digital filters.
00: fDTS=fTIMER_CK
01: fDTS=fTIMER_CK /2
10: fDTS=fTIMER_CK /4
11: Reserved
Auto-reload shadow enable
0: The shadow register for TIMx_ARR register is disabled
1: The shadow register for TIMx_ARR register is enabled
Counter aligns mode selection
00: No center-aligned mode (edge-aligned mode). The direction of the counter is
specified by the DIR bit.
01: Center-aligned and counting down assert mode. The counter counts under
center-aligned and channel is configured in output mode (CCxS=00 in
TIMx_CCMR1 register). Only when the counter is counting down, compare interrupt
flag of channels can be set.
10: Center-aligned and counting up assert mode. The counter counts under
center-aligned and channel is configured in output mode (CCxS=00 in
TIMx_CCMR1 register). Only when the counter is counting up, compare interrupt
flag of channels can be set.
11: Center-aligned and counting up/down assert mode. The counter counts under
center-aligned and channel is configured in output mode (CCxS=00 in
TIMx_CCMR1 register). Both when the counter is counting up and counting down,
compare interrupt flag of channels can be set.
After the counter is enabled, cannot be switched from 0x00 to non 0x00.
Direction
0: Count up
1: Count down
This bit is read only when the timer is configured in center-aligned mode or encoder
mode.
Single pulse mode.
0: Single pulse mode disable. Counter continues after update event.
1: Single pulse mode enable. The CEN is cleared by hardware and the counter
stops at next update event.
Update source
This bit is used to select the update event sources by software.
0: Any of the following events generate an update interrupt or DMA request:

Rev01

234

WB32FQ95xx Reference Manual

Bits

Fields

RW

1

UDIS

RW

0

CEN

RW

16.5.2.

Descriptions
– The UG bit is set
– The counter generates an overflow or underflow event
– The slave mode controller generates an update event.
1: Only counter overflow/underflow generates an update interrupt or DMA request.
Update disable.
This bit is used to enable or disable the update event generation.
0: update event enable. The update event is generate and the buffered registers are
loaded with their preloaded values when one of the following events occurs:
– The UG bit is set
– The counter generates an overflow or underflow event
– The slave mode controller generates an update event.
1: update event disable. The buffered registers keep their value, while the counter
and the prescaler are reinitialized if the UG bit is set or if the slave mode controller
generates a hardware reset event.
Counter enable
0: Counter disable
1: Counter enable
The CEN bit must be set by software when timer works in external clock, pause
mode and encoder mode. While in event mode, the hardware can set the CEN bit
automatically.

Control register 2 (TIMx_CR2)
Address offset: 0x04
Reset value: 0x0000

Bits

Fields

RW

31-8

Reserved

R

Descriptions
Must be kept at reset value
Channel 1 trigger input selection

7

TI1S

RW

0: The TIMx_CH1 pin input is selected as Channel 1 trigger input.
1: The result of combinational XOR of TIMx_CH1, CH2 and CH3 pins is selected as
Channel 1 trigger input.
Master mode control
These bits control the selection of TRGO signal, which is sent in master mode to
slave timers for synchronization function.
000: Reset. When the UG bit in the TIMx_EGR register is set or a reset is generated
by the slave mode controller, a TRGO pulse occurs. And in the latter case, the signal
on TRGO is delayed compared to the actual reset.
001: Enable. This mode is useful to start several timers at the same time or to
control a window in which a slave timer is enabled. In this mode the master mode

6:4

MMS[2:0]

RW

controller selects the counter enable signal as TRGO. The counter enable signal is
set when CEN control bit is set or the trigger input in pause mode is high. There is a
delay between the trigger input in pause mode and the TRGO output, except if the
master-slave mode is selected.
010: Update. In this mode the master mode controller selects the update event as
TRGO.
011: Capture/compare pulse. In this mode the master mode controller generates a
TRGO pulse when a capture or a compare match occurred in channal0 .
100: Compare. In this mode the master mode controller selects the O1CPRE signal is
used as TRGO

Doc ID 2905025

Rev01

235

WB32FQ95xx Reference Manual

Bits

Fields

RW

Descriptions
101: Compare. In this mode the master mode controller selects the O2CPRE signal is
used as TRGO
110: Compare. In this mode the master mode controller selects the O3CPRE signal is
used as TRGO
111: Compare. In this mode the master mode controller selects the O4CPRE signal is
used as TRGO
DMA request source selection

3

CCDS

RW

0: DMA request of channel x is sent when capture/compare event occurs.
1: DMA request of channel x is sent when update event occurs.

2:0

16.5.3.

-

Reserved bits

Slave mode configuration register (TIMx_SMCR)
Address offset: 0x08
Reset value: 0x0000

Bits

Fields

RW

31:16

-

R

15

ETP

RW

14

ECE

RW

13:12

ETPS[1:0]

RW

11:8

ETF[3:0]

RW

Doc ID 2905025

Descriptions
Reserved bits
External trigger polarity
This bit specifies the polarity of ETR signal
0: ETR is active at high level or rising edge.
1: ETR is active at low level or falling edge.
Part of SMS for enable External clock mode 2.
In external clock mode 2, the counter is clocked by any active edge on the ETRF
signal.
0: External clock mode 2 disabled
1: External clock mode 2 enabled.
Note:
It is possible to simultaneously use external clock mode 2 with the restart mode,
pause mode or event mode(TS bits must not be 3’b111).
The external clock input will be ETRF if external clock mode 1 and external clock
mode 2 are enabled at the same time.
External clock mode 1 enable is in this register’s SMS bit-filed.
External trigger prescaler
The frequency of external trigger signal ETRP must not be at higher than 1/4 of
TIMER_CK frequency. When the external trigger signal is a fast clock, the
prescaler can be enabled to reduce ETRP frequency.
00: Prescaler disable
01: ETRF frequency will be divided by 2
10: ETRF frequency will be divided by 4
11: ETRF frequency will be divided by 8
External trigger filter control
An event counter is used in the digital filter, in which a transition on the output
occurs after N input events. This bit-field specifies the frequency used to sample
ETRP signal and the length of the digital filter applied to ETRP.
0000: Filter disabled, fSAMP=fDTS, N=1
0001: fSAMP=fTIMER_CK, N=2
0010: fSAMP=fTIMER_CK, N=4
0011: fSAMP=fTIMER_CK, N=8
0100: fSAMP =fDTS/2, N=6

Rev01

236

WB32FQ95xx Reference Manual

Bits

Fields

RW

Descriptions
0101: fSAMP =fDTS/2, N=8
0110: fSAMP =fDTS/4, N=6
0111: fSAMP =fDTS/4, N=8
1000: fSAMP =fDTS/8, N=6
1001: fSAMP =fDTS/8, N=8
1010: fSAMP =fDTS/16, N=5
1011: fSAMP =fDTS/16, N=6
1100: fSAMP =fDTS/16, N=8
1101: fSAMP =fDTS/32, N=5
1110: fSAMP =fDTS/32, N=6
1111: fSAMP =fDTS/32, N=8
Master-slave mode
This bit can be used to synchronize selected timers to begin counting at the same
time. The TRGI is used as the start event, and through TRGO, timers are
connected together.
0: Master-slave mode disable
1: Master-slave mode enable
Trigger selection
This bit-field specifies which signal is selected as the trigger input, which is used to
synchronize the counter.
000: Internal trigger input 0 (ITR0)
001: Internal trigger input 1 (ITR1)
010: Internal trigger input 2 (ITR2)
011: Internal trigger input 3 (ITR3)
100: TI1 edge flag (TI1F_ED)
101: Channel 1 input Filtered output (TI1FP1)
110: Channel 2 input Filtered output (TI2FP2)
111: External trigger input filter output(ETRF)
These bits must not be changed when slave mode is enabled.

7

MSM

RW

6:4

TS[2:0]

RW

3

Reserved

R

Must be kept at reset value.

RW

Slave mode control
000: Disable mode. The slave mode is disabled; The prescaler is clocked directly by
the internal clock (TIMER_CK) when CEN bit is set high.
001: Quadrature decoder mode 0.The counter counts on TI2FP2 edge, while the
direction depends on TI1FP1 level.
010: Quadrature decoder mode 1.The counter counts on TI1FP1 edge, while the
direction depends on TI2FP2 level.
011: Quadrature decoder mode 2.The counter counts on both TI1FP1 and TI2FP2
edge, while the direction depends on each other.
100: Restart mode. The counter is reinitialized and the shadow registers are
updated on the rising edge of the selected trigger input.
101: Pause mode. The trigger input enables the counter clock when it is high and
disables the counter when it is low.
110: Event mode. A rising edge of the trigger input enables the counter. The counter
cannot be disabled by the slave mode controller.
111: External clock mode 1. The counter counts on the rising edges of the selected
trigger.

2:0

16.5.4.

SMS[2:0]

DMA and interrupt enable register (TIMx_DIER)
Address offset: 0x0C
Reset value: 0x0000

Doc ID 2905025

Rev01

237

WB32FQ95xx Reference Manual

Bits

Fields

RW

31:15

-

R

Reserved bits

14

TDE

RW

Trigger DMA request enable
0: disabled
1: enabled

13

-

R

Reserved bit

12

CC4DE

RW

11

CC3DE

RW

10

CC2DE

RW

9

CC1DE

RW

8

UDE

RW

7

-

R

Reserved bit

6

TE

RW

Trigger interrupt enable
0: disabled
1: enabled

5

-

R

Reserved bit

4

CC4IE

RW

3

CC3IE

RW

2

CC2IE

RW

1

CC1IE

RW

0

UIE

RW

16.5.5.

Descriptions

Channel 4 capture/compare DMA request enable
0: disabled
1: enabled
Channel 3 capture/compare DMA request enable
0: disabled
1: enabled
Channel 2 capture/compare DMA request enable
0: disabled
1: enabled
Channel 1 capture/compare DMA request enable
0: disabled
1: enabled
Update DMA request enable
0: disabled
1: enabled

Channel 4 capture/compare interrupt enable
0: disabled
1: enabled
Channel 3 capture/compare interrupt enable
0: disabled
1: enabled
Channel 2 capture/compare interrupt enable
0: disabled
1: enabled
Channel 1 capture/compare interrupt enable
0: disabled
1: enabled
Update interrupt enable
0: disabled
1: enabled

Interrupt flag register (TIMx_SR)
Address offset: 0x10
Reset value: 0x0000

Bits

Fields

RW

31:13

Reserved

R

Doc ID 2905025

Descriptions
Must be kept at reset value.

Rev01

238

WB32FQ95xx Reference Manual

Bits

Fields

RW

12

CC4OF

RC_W0

11

CC3OF

10

CC2OF

9

CC1OF

8:7

-

Channel 4 over capture flag
Refer to CC1OF description
Channel 3 over capture flag
RC_W0
Refer to CC1OF description
Channel 2 over capture flag
RC_W0
Refer to CC1OF description
Channel 1 over capture flag
When Channel 1 is configured in input mode, this flag is set by hardware when a
capture event occurs while CC1IF flag has already been set. This flag is cleared by
RC_W0
software.
0: No over capture interrupt occurred
1: Over capture interrupt occurred
R

Reserved bits

Trigger interrupt flag
This flag is set by hardware on trigger event and cleared by software. When the
slave mode controller is enabled in all modes but pause mode, an active edge on
RC_W0 trigger input generates a trigger event. When the slave mode controller is enabled
in pause mode both edges on trigger input generates a trigger event.
0: No trigger event occurred.
1: Trigger interrupt occurred.

6

TIF

5

-

R

4

CC4IF

RC_W0

3

CC3IF

RC_W0

2

CC2IF

RC_W0

1

CC1IF

RC_W0

0

UIF

RC_W0

16.5.6.

Descriptions

Reserved bit
Channel 4‘s capture/compare interrupt flag
Refer to CC1IF description
Channel 3‘s capture/compare interrupt flag
Refer to CC1IF description
Channel 2‘s capture/compare interrupt flag
Refer to CC1IF description
Channel 1‘s capture/compare interrupt flag
This flag is set by hardware and cleared by software. When Channel 1 is in input
mode, this flag is set when a capture event occurs. When Channel 1 is in output
mode, this flag is set when a compare event occurs.
0: No Channel 1 interrupt occurred
1: Channel 1 interrupt occurred
Update interrupt flag
This bit is set by hardware on an update event and cleared by software.
0: No update interrupt occurred
1: Update interrupt occurred

Software event generation register (TIMx_EGR)
Address offset: 0x14
Reset value: 0x0000

Bits

Fields

RW

31:7

Reserved

R

Must be kept at reset value.

W

Trigger event generation
This bit is set by software and cleared by hardware automatically. When this bit is
set, the TIF flag in TIMx_SR register is set, related interrupt or DMA transfer can
occur if enabled.
0: No generate a trigger event
1: Generate a trigger event

6

TG

Doc ID 2905025

Descriptions

Rev01

239

WB32FQ95xx Reference Manual

Bits

Fields

RW

5

-

R

4

CC4G

W

3

CC3G

W

2

CC2G

W

1

CC1G

W

0

UG

W

16.5.7.

Descriptions
Reserved bit
Channel 4’s capture or compare event generation
Refer to CC1G description
Channel 3’s capture or compare event generation
Refer to CC1G description
Channel 2’s capture or compare event generation
Refer to CC1G description
Channel 1’s capture or compare event generation
This bit is set by software in order to generate a capture or compare event in
Channel 1, it is automatically cleared by hardware. When this bit is set, the CC1IF
flag is set, the corresponding interrupt or DMA request is sent if enabled. In addition,
if Channel 2 is configured in input mode, the current value of the counter is captured
in TIMx_CCR1 register, and the CC1OF flag is set if the CC1IF flag was already
high.
0: No generate a Channel 2 capture or compare event
1: Generate a Channel 2 capture or compare event
Update event generation
This bit can be set by software, and cleared by hardware automatically. When this
bit is set, the counter is cleared if the center-aligned or up counting mode is
selected, else (down counting) it takes the auto-reload value. The prescaler counter
is cleared at the same time.
0: No generate an update event
1: Generate an update event

Channel control register 0 (TIMx_CCMR1)
Address offset: 0x18
Reset value: 0x0000
Output compare mode:

Bits

Fields

RW

31:16

-

R

15

OC2CE

RW

14:12

OC2M[2:0]

RW

11

OC2PE

RW

10

OC2FE

RW

9:8

CC2S[1:0]

RW

7

OC1CE

RW

Doc ID 2905025

Descriptions
Reserved bits
Output Compare 2 clear enable
Refer to OC1CE description
Output Compare 2 mode
Refer to OC1M description
Output Compare 2 preload enable
Refer to OC1PE description
Output Compare 2 fast enable
Refer to OC1PE description
Capture/Compare 2 selection
This bit-field specifies the direction of the channel and the input signal selection.
This bit-field is writable only when the channel is not active. (CC2E bit in
TIMx_CCER register is reset).
00: Channel 2 is configured as output
01: Channel 2 is configured as input, IC2 is mapped on TI2
10: Channel 2 is configured as input, IC2 is mapped on TI2
11: Channel 2 is configured as input, IC2 is connected to TRC. This mode is
working only if an internal trigger input is selected through TS bits in TIMx_SMCR
register.
Output Compare 1 clear enable
When this bit is set, the O1CPRE signal is cleared when High level is detected on

Rev01

240

WB32FQ95xx Reference Manual

Bits

Fields

RW

6:4

OC1M[2:0]

RW

3

OC1PE

RW

2

OC1FE

RW

1:0

CC1S[1:0]

RW

Doc ID 2905025

Descriptions
ETRF input.
0: Channel 1 output compare clear disable
1: Channel 1 output compare clear enable
Output Compare 1 mode
This bit-field controls the behavior of the output reference signal O1CPRE which
drives CH1_O and CH1_ON . O1CPRE is active high, while CH1_O and CH1_ON
active level depends on CC1P and CC1NP bits.
000: Frozen. The O1CPRE signal keeps stable, independent of the comparison
between the register TIMx_CCR1 and the counter TIMx_CNT.
001: Set the channel output. O1CPRE signal is forced high when the counter
matches the output compare register TIMx_CCR1.
010: Clear the channel output. O1CPRE signal is forced low when the counter
matches the output compare register TIMx_CCR1.
011: Toggle on match. O1CPRE toggles when the counter matches the output
compare register TIMx_CCR1.
100: Force low. O1CPRE is forced low level.
101: Force high. O1CPRE is forced high level.
110: PWM mode1. When counting up, O1CPRE is high as long as the counter is
smaller than TIMx_CCR1 else low. When counting down, O1CPRE is low as long
as the counter is larger than TIMx_CCR1 else high.
111: PWM mode2. When counting up, O1CPRE is low as long as the counter is
smaller than TIMx_CCR1 else high. When counting down, O1CPRE is high as long
as the counter is larger than TIMx_CCR1 else low.
Note:
When configured in PWM mode, the O1CPRE level changes only when the output
compare mode switches from “frozen” mode to “PWM” mode or when the result of
the comparison changes.
These bits cannot be modified when LOCK [1:0] bit-filed in TIMx_BDTR register is
11 and CC1S bit-filed is 00(COMPARE MODE).
Output Compare 1 preload enable
When this bit is set, the shadow register of TIMx_CCR1 register, which
updates at each update event, will be enabled.
0: Channel 1 output compare shadow disable
1: Channel 1 output compare shadow enable
The PWM mode can be used without validating the shadow register only in single
pulse mode (OPM bit in TIMx_CR1 register is set).
This bit cannot be modified when LOCK [1:0] bit-filed in TIMx_BDTR register is 11
and CC1S bit-filed is 00.
Output Compare 1 fast enable
When this bit is set, the effect of an event on the trigger in input on the
capture/compare output will be accelerated if the channel is configured in PWM0 or
PWM1 mode. The output channel will treat an active edge on the trigger input as a
compare match, and CH1_O is set to the compare level independently from the
result of the comparison.
0: Channel 1 output quickly compare disable. The minimum delay from an edge on
the trigger input to activate CH1_O output is 5 clock cycles.
1: Channel 1 output quickly compare enable. The minimum delay from an edge on
the trigger input to activate CH1_O output is 3 clock cycles.
Capture/Compare 1 selection
This bit-field specifies the work mode of the channel and the input signal selection.
This bit-field is writa ble only when the channel is not active. (CC1E bit in
TIMx_CCER register is reset).
00: Channel 1 is configured as output

Rev01

241

WB32FQ95xx Reference Manual

Bits

Fields

RW

Descriptions
01: Channel 1 is configured as input, IC1 is connected to TI1FP1
10: Channel 1 is configured as input, IC1 is connected to TI2FP1
11: Channel 1 is configured as input, IC1 is connected to TRC. This mode is
working only if an internal trigger input is selected through TS bits in TIMx_SMCR
register.

Input capture mode:
Bits

Fields

RW

31:16

-

R

15:12

IC2F[3:0]

RW

11:10

IC2PSC[1:0]

RW

9:8

CC2S[1:0]

RW

7:4

IC1F[3:0]

RW

Descriptions
Reserved bits
Input capture 2 filter
Refer to IC1F description
Channel 2 input capture prescaler
Refer to IC1PSC description
Capture/Compare 2 selection
Same as Output compare mode
Input capture 1 filter
An event counter is used in the digital filter, in which a transition on the output
occurs after N input events. This bit-field specifies the frequency used to sample TI1
input signal and the length of the digital filter applied to TI1.
0000: Filter disabled, fSAMP=fDTS, N=1
0001: fSAMP=fTIMER_CK, N=2
0010: fSAMP=fTIMER_CK, N=4
0011: fSAMP=fTIMER_CK, N=8
0100: fSAMP =fDTS/2, N=6
0101: fSAMP =fDTS/2, N=8
0110: fSAMP =fDTS/4, N=6
0111: fSAMP =fDTS/4, N=8
1000: fSAMP =fDTS/8, N=6
1001: fSAMP =fDTS/8, N=8
1010: fSAMP =fDTS/16, N=5
1011: fSAMP =fDTS/16, N=6
1100: fSAMP =fDTS/16, N=8
1101: fSAMP =fDTS/32, N=5
1110: fSAMP =fDTS/32, N=6
1111: fSAMP =fDTS/32, N=8
Input capture 1 prescaler
This bit-field specifies the factor of the prescaler on Channel 1 input. The prescaler

3:2

IC1PSC[1:0]

RW

1:0

CC1S[1:0]

RW

16.5.8.

is reset when CC1E bit in TIMx_CCER register is clear.
00: Prescaler disable, capture is done on each channel input edge
01: Capture is done every 2 channel input edges
10: Capture is done every 4channel input edges
11: Capture is done every 8 channel input edges
Capture/Compare 1 Selection
Same as Output compare mode

Channel control register 1 (TIMx_CCMR2)
Address offset: 0x1C
Reset value: 0x0000

Doc ID 2905025

Rev01

242

WB32FQ95xx Reference Manual

Output compare mode:
Bits

Fields

RW

31:16

-

R

15

OC4CE

RW

14:12

OC4M[2:0]

RW

11

OC4PE

RW

10

OC4FE

RW

9:8

CC4S[1:0]

RW

7

OC3CE

RW

6:4

OC3M[2:0]

RW

Doc ID 2905025

Descriptions
Reserved bits
Output compare 4 clear enable
Refer to OC1CE description
Channel 4 compare output control
Refer to OC1M description
Output compare 4 preload enable
Refer to OC1PE description
Output compare 4 fast enable
Refer to OC1PE description
Capture/Compare 4 selection
This bit-field specifies the direction of the channel and the input signal selection.
This bit-field is writable only when the channel is not active. (CC4E bit in
TIMx_CCER register is reset).
00: Channel 4 is configured as output
01: Channel 4 is configured as input, IC4 is mapped on TI4
10: Channel 4 is configured as input, IC4 is mapped on TI3
11: Channel 4 is configured as input, IC4 is connected to TRC, This mode is
working only if an internal trigger input is selected through TS bits in TIMx_SMCR
register.
Output compare 3 clear enable
When this bit is set, the O3CPRE signal is cleared when High level is detected on
ETRF input.
0: Channel 3 output compare clear disable
1: Channel 3 output compare clear enable
Output compare 3 mode
This bit-field controls the behavior of the output reference signal O3CPRE which
drives CH3_O and CH3_ON . O3CPRE is active high, while CH3_O and CH3_ON
active level depends on CC3P and CC3NP bits.
000: Frozen. The O3CPRE signal keeps stable, independent of the comparison
between the output compare register TIMx_CCR3 and the counter TIMx CNT .
001: Set high on match. O3CPRE signal is forced high when the counter matches
the output compare register TIMx_CCR3.
010: Set low on match. O3CPRE signal is forced low when the counter matches the
output compare register TIMx_CCR3.
011: Toggle on match. O3CPRE toggles when the counter matches the output
compare register TIMx_CCR3.
100: Force low. O3CPRE is forced low level.
101: Force high. O3CPRE is forced high level.
110: PWM mode 1. When counting up, O3CPRE is high as long as the counter is
smaller than TIMx_CCR3 else low. When counting down, O3CPRE is low as long
as the counter is larger than TIMx_CCR3 else high.
111: PWM mode 2. When counting up, O3CPRE is low as long as the counter is
smaller than TIMx_CCR3 else high. When counting down, O3CPRE is high as long
as the counter is larger than TIMx_CCR3 else low.
Note:
When configured in PWM mode, the O3CPRE level changes only when the output
compare mode switches from “frozen” mode to “PWM” mode or when the result of
the comparison changes.
This bit cannot be modified when LOCK [1:0] bit-filed in TIMx_BDTR register is 11
and CC3S bit-filed is 00(COMPARE MODE).

Rev01

243

WB32FQ95xx Reference Manual

Bits

Fields

RW

3

OC3PE

RW

2

OC3FE

RW

1:0

CC3S[1:0]

RW

Descriptions
Output compare 3 preload enable
When this bit is set, the shadow register of TIMx_CCR3 register, which updates at
each update event will be enabled.
0: Channel 3 output compare shadow disable
1: Channel 3 output compare shadow enable
Note:
The PWM mode can be used without validating the shadow register only in single
pulse mode (OPM bit in TIMx_CR1 register is set) .
This bit cannot be modified when LOCK [1:0] bit-filed in TIMx_BDTR register is 11
and CC1S bit-filed is 00.
Output compare 3 fast enable
When this bit is set, the effect of an event on the trigger in input on the
capture/compare output will be accelerated if the channel is configured in PWM1 or
PWM2 mode. The output channel will treat an active edge on the trigger input as a
compare match, and CH3_O is set to the compare level independently from the
result of the comparison.
0: Channel 3 output quickly compare disable. The minimum delay from an edge on
the trigger input to activate CH3_O output is 5 clock cycles.
1: Channel 3 output quickly compare enable. The minimum delay from an edge on
the trigger input to activate CH3_O output is 3 clock cycles.
Capture/Compare 3 selection
This bit-field specifies the work mode of the channel and the input signal selection.
This bit-field is writable only when the channel is not active. (CC3E bit in
TIMx_CCER register is reset).).
00: Channel 3 is configured as output
01: Channel 3 is configured as input, IC3 is mapped on TI3
10: Channel 3 is configured as input, IC3 is mapped on TI4
11: Channel 3 is configured as input, IC3 is connected to TRC. This mode is
working only if an internal trigger input is selected through TS bits in TIMx_SMCR
register.

Input capture mode:
Bits

Fields

RW

31:16

-

R

15:12

IC4F[3:0]

RW

11:10

IC4PSC[1:0]

RW

9:8

CC4S[1:0]

RW

7:4

IC3F[3:0]

RW

Doc ID 2905025

Descriptions
Reserved bits
Input capture 4 filter
Refer to IC3F description
Input capture 4 prescaler
Refer to IC3PSC description
Capture/Compare 4 selection
Same as Output compare mode
Input capture 3 filter
An event counter is used in the digital filter, in which a transition on the output
occurs after N input events. This bit-field specifies the frequency used to sample
TI3 input signal and the length of the digital filter applied to TI3.
0000: Filter disabled, fSAMP=fDTS, N=1
0001: fSAMP=fTIMER_CK, N=2
0010: fSAMP=fTIMER_CK, N=4
0011: fSAMP=fTIMER_CK, N=8
0100: fSAMP =fDTS/2, N=6
0101: fSAMP =fDTS/2, N=8
0110: fSAMP =fDTS/4, N=6
0111: fSAMP =fDTS/4, N=8
1000: fSAMP =fDTS/8, N=6
1001: fSAMP =fDTS/8, N=8
1010: fSAMP =fDTS/16, N=5

Rev01

244

WB32FQ95xx Reference Manual

Bits

Fields

RW

3:2

IC3PSC[1:0]

RW

1:0

CC3S[1:0]

RW

16.5.9.

Descriptions
1011: fSAMP =fDTS/16, N=6
1100: fSAMP =fDTS/16, N=8
1101: fSAMP =fDTS/32, N=5
1110: fSAMP =fDTS/32, N=6
1111: fSAMP =fDTS/32, N=8
Input capture 3 prescaler
This bit-field specifies the factor of the prescaler on Channel 3 input. The
prescaler is reset when CC3E bit in TIMx_CCER register is clear.
00: Prescaler disable, capture is done on each channel input edge
01: Capture is done every 2 channel input edges
10: Capture is done every 4 channel input edges
11: Capture is done every 8 channel input edges
Capture/compare 3 selection
Same as Output compare mode

Channel control register 2 (TIMx_CCER)
Address offset: 0x20
Reset value: 0x0000

Bits

Fields

RW

31:14

Reserved

R

13

CC4P

RW

12

CC4E

RW

11:10

-

R

9

CC3P

RW

8

CC3E

RW

7:6

-

R

5

CC2P

RW

4

CC2E

RW

3:2

-

R

Reserved bits

RW

Channel 1 capture/compare function polarity
When Channel 1 is configured in output mode, this bit specifies the output signal
polarity.
0: Channel 1 active high
1: Channel 1 active low
When Channel 1 is configured in input mode, this bit specifies the TI1 signal
polarity.
0: TI1 is non-inverted. Input capture is done on a rising edge of TI1. When used as
extern trigger, TI1 is non-inverted.
1: TI1 is inverted. Input capture is done on a falling edge of TI1. When used as
extern trigger, TI1 is inverted.
Note: This bit cannot be modified when LOCK [1:0] bit-filed in TIMx_BDTR register
is 11 or 10.

1

CC1P

Doc ID 2905025

Descriptions
Must be kept at reset value
Channel 4 capture/compare function polarity
Refer to CC1P description
Channel 4 capture/compare function enable
Refer to CC1E description
Reserved bits
Channel 3 capture/compare function polarity
Refer to CC1P description
Channel 3 capture/compare function enable
Refer to CC1E description
Reserved bits
Channel 2 capture/compare function polarity
Refer to CC1P description
Channel 2 capture/compare function enable
Refer to CC1E description

Rev01

245

WB32FQ95xx Reference Manual

Bits

0

16.5.10.

Fields

CC1E

RW

Descriptions

RW

Channel 1 capture/compare function enable
When Channel 1 is configured in output mode, setting this bit enables CH1_O
signal in active state. When Channel 1 is configured in input mode, setting this bit
enables the capture event in channel0.
0: Channel 1 disabled
1: Channel 1 enabled

Counter register (TIMx_CNT)
Address offset: 0x24
Reset value: 0x0000

Bits

Fields

RW

31:20

-

R

Reserved bits

19:0

CNT[19:0]

RW

This bit-filed indicates the current counter value. Writing to this bit-filed can change
the value of the counter.

16.5.11.

Descriptions

Prescaler register (TIMx_PSC)
Address offset: 0x28
Reset value: 0x0000

Bits

Fields

RW

31:16

-

R

Reserved bits

RW

Prescaler value of the counter clock
The PSC clock is divided by (PSC+1) to generate the counter clock. The value of
this bit-filed will be loaded to the corresponding shadow register at every update
event.

15:0

16.5.12.

PSC[15:0]

Descriptions

Counter auto reload register (TIMx_ARR)
Address offset: 0x2C
Reset value: 0x0000

Bits

Fields

RW

31:20

-

R

Reserved bits

RW

Counter auto reload value
This bit-filed specifies the auto reload value of the counter.
Note: When the timer is configured in input capture mode, this register must be
configured a non-zero value (such as 0xFFFF) which is larger than user expected
value.

19:0

16.5.13.

ARR[19:0]

Descriptions

Channel 1 capture/compare value register (TIMx_CCR1)
Address offset: 0x34
Reset value: 0x0000

Bits

Fields

Doc ID 2905025

RW

Descriptions

Rev01

246

WB32FQ95xx Reference Manual

Bits

Fields

RW

31:20

-

R

Reserved bits

RW

Capture or compare value of channel0
When Channel 1 is configured in input mode, this bit-filed indicates the counter
value corresponding to the last capture event. And this bit-filed is read-only.
When Channel 1 is configured in output mode, this bit-filed contains value to be
compared to the counter. When the corresponding shadow register is enabled,
the shadow register updates every update event.

19:0

16.5.14.

CCR1[19:0]

Descriptions

Channel 2 capture/compare value register (TIMx_CCR2)
Address offset: 0x38
Reset value: 0x0000

Bits

Fields

RW

31:20

-

R

Reserved bits

RW

Capture or compare value of channel1
When Channel 2 is configured in input mode, this bit-filed indicates the counter
value corresponding to the last capture event. And this bit-filed is read-only.
When Channel 2 is configured in output mode, this bit-filed contains value to be
compared to the counter. When the corresponding shadow register is enabled,
the shadow register updates every update event.

19:0

16.5.15.

CCR2[19:0]

Descriptions

Channel 3 capture/compare value register (TIMx_CCR3)
Address offset: 0x3C
Reset value: 0x0000

Bits

Fields

RW

31:20

-

R

Reserved bits

RW

Capture or compare value of Channel 3
When Channel 3 is configured in input mode, this bit-filed indicates the counter
value corresponding to the last capture event. And this bit-filed is read-only.
When Channel 3 is configured in output mode, this bit-filed contains value to be
compared to the counter. When the corresponding shadow register is enabled, the
shadow register updates every update event.

19:0

16.5.16.

CCR3[19:0]

Descriptions

Channel 4 capture/compare value register (TIMx_CCR4)
Address offset: 0x40
Reset value: 0x0000

Bits

Fields

RW

31:20

-

R

Reserved bits

RW

Capture or compare value of Channel 4
When channel4 is configured in input mode, this bit-filed indicates the counter
value corresponding to the last capture event. And this bit-filed is read-only.
When Channel 4 is configured in output mode, this bit-filed contains value to be
compared to the counter. When the corresponding shadow register is enabled, the

19:0

CCR4[19:0]

Doc ID 2905025

Descriptions

Rev01

247

WB32FQ95xx Reference Manual

Bits

Fields

RW

Descriptions
shadow register updates every update event.

Doc ID 2905025

Rev01

248

