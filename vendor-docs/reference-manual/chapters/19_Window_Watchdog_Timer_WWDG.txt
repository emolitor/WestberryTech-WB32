WB32FQ95xx Reference Manual

19.

Window watchdog timer (WWDG)

19.1.

Overview
The window watchdog timer (WWDG) is used to detect system failures due to software
malfunctions. After the window watchdog timer starts, the value of downcounter reduces
progressively. The watchdog timer causes a reset when the counter reached 0x3F (the
CNT[6] bit becomes cleared). The watchdog timer also causes a reset if the counter is
refreshed before the counter reached the window register value. So the software should
refresh the counter in a limited window. The window watchdog timer generates an early
wakeup status flag when the counter reaches 0x40 or refreshes before the counter reaches
the window value. Interrupt occurs if it is enabled.
The window watchdog timer clock is prescaled from the APB2 clock. The window watchdog
timer is suitable for the situation that requires an accurate timing.

19.2.

19.3.

Characteristics
⚫

Programmable free-running 7-bit downcounter.

⚫

Generate reset in two conditions when WWDG is enabled:
◼

Reset when the counter reached 0x3F.

◼

The counter is refreshed when the value of the counter is greater than the window
register value.

⚫

Early wakeup interrupt (EWI): if the watchdog is started and the interrupt is enabled, the
interrupt occurs when the counter reaches 0x40 or refreshes before it reaches the
window value.

⚫

WWDG debug mode, the WWDG can stop or continue to work in debug mode.

Function overview
If the window watchdog timer is enabled (set the WDGA bit in the WWDG_CR), the
watchdog timer cause a reset when the counter reaches 0x3F (the CNT[6] bit becomes
cleared), or when the counter is refreshed before the counter reaches the window register
value.
Figure 19-1. Window watchdog timer block diagram

Doc ID 2905025

Rev01

258

WB32FQ95xx Reference Manual

The watchdog is always disabled after power on reset. The software starts the watchdog by
setting the WDGA bit in the WWDG_CR register. Whenever window watchdog timer is
enabled, the counter counts down all the time, the configured value of the counter should be
greater than 0x3F, it implies that the CNT[6] bit should be set. The CNT[5:0] determine the
maximum time interval of two reloading. The countdown speed depends on the APB2 clock
and the prescaler (PSC[1:0] bits in the WWDG_CFR register).
The WIN[6:0] bits in the configuration register (WWDG_CFR) specifies the window value.
The software can prevent the reset event by reloading the downcounter when counter value
is less than the window value and greater than 0x3F, otherwise the watchdog causes a reset.
The early wakeup interrupt (EWI) is enabled by setting the EWIE bit in the WWDG_CFR
register, and the interrupt is generated when the counter reaches 0x40 or the counter is
refreshed before it reaches the window value. The software can do something such as
communication or data logging in the interrupt service routine (ISR) in order to analyse the
reason of software malfunctions or save the important data before resetting the device.
Moreover the software can reload the counter in ISR to manage a software system check
and so on. In this case, the WWDG will never generate a WWDG reset but can be used for
other things.
The EWI interrupt is cleared by writing '0' to the EWIF bit in the WWDG_SR register.
Figure 19-2. Window watchdog timing diagram

Calculate the WWDG timeout by using the formula below.
tWWDG=tPCLK2 × 4096 ×2PSC× (CNT[5: 0] + 1)

(ms)

(20-1)

where:
tWWDG: WWDG timeout
tPCLK2:

APB2 clock period measured in ms

If the DBG_WWDG_STOP bit in DBG module is cleared, the WWDG continues to work even
the Cortex™-M3 core halted (Debug mode). While the DBG_WWDG_STOP bit is set, the
WWDG stops in Debug mode.

Doc ID 2905025

Rev01

259

WB32FQ95xx Reference Manual

19.4.

Register definition

19.4.1.

Control register (WWDG_CR)
Address offset: 0x00
Reset value: 0x0000 007F

Bits

Fields

R/W

31:8

-

R

7

WDGA

RS

6:0

CNT

RW

19.4.2.

Description
Reserved
Start the window watchdog timer. Cleared by a hardware reset. Writing 0
has no effect.
0: Window watchdog timer disabled
1: Window watchdog timer enabled
The value of the watchdog timer counter. A reset occurs when the value of
this counter decreases from 0x40 to 0x3F. When the value of this counter
is greater than the window value, writing this counter also causes a reset

Configuration register (WWDG_CFR)
Address offset: 0x04
Reset value: 0x0000 007F

Bits

Fields

R/W

31:10

-

R

9

EWI

RS

8:7

WDGTB

RW

6:0

WIN

RW

19.4.3.

Description
Reserved
Early wakeup interrupt enable. An interrupt occurs when the counter
reaches 0x40 or the counter is refreshed before it reaches the window
value if the bit is set. It can be cleared by a hardware reset or by a RCC
WWDG software reset. A write operation of ‘0’ has no effect.
Prescaler. The time base of the watchdog timer counter
00: (PCLK2 / 4096) / 1
01: (PCLK2 / 4096) / 2
10: (PCLK2 / 4096) / 4
11: (PCLK2 / 4096) / 8
The Window value. A reset occurs if the watchdog counter (CNT bits in
WWDG_CR) is written when the value of the watchdog counter is greater
than the Window value.

Status register (WWDG_SR)
Address offset: 0x08
Reset value: 0x0000 0000

Bits

Fields

R/W

31:1

-

R

0

EWIF

Doc ID 2905025

RC_W0

Description
Reserved
Early wakeup interrupt flag. When the counter reaches 0x40 or refreshes
before it reaches the window value, this bit is set by hardware even the
interrupt is not enabled (EWI in WWDG_CFR is cleared). This bit is
cleared by writing 0 to it.
There is no effect when writing 1 to it.

Rev01

260

