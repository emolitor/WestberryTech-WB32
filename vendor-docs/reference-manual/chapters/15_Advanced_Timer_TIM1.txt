WB32FQ95xx Reference Manual

15.

Advanced timer (TIM1)

15.1.

Overview
The advanced timer module (TIM1) is a four-channel timer that supports both input capture
and output compare. They can generate PWM signals to control motor or be used for power
management applications. The advanced timer has a 20-bit counter that can be used as an
unsigned counter.
In addition, the advanced timers can be programmed and be used for counting, their external
events can be used to drive other timers.
Timer also includes a dead-time Insertion module which is suitable for motor control
applications.
Advanced Timer (TIM1) and General Timer (TIMx) are completely independent with each
other, but they may be synchronized to provide a larger timer with their counters increment in
unison.

15.2.

Characteristics
⚫

Total channel number: 4.

⚫

Counter width: 20bit.

⚫

Source of counter clock is select-able:
◼

internal clock

◼

internal trigger

◼

external input

◼

external trigger

⚫

Multiple counter modes: count up, count down, count up/down.

⚫

Quadrature Decoder: used to track motion and determine both rotation direction and
position.

⚫

Hall sensor: for 3-phase motor control.

⚫

Programmable prescaler: 16 bit. The factor can be changed on the go.

⚫

Each channel is user-configurable:
◼

input capture mode

◼

output compare mode

◼

programmable PWM mode

◼

single pulse mode

⚫

Complementary outputs with programmable dead time insertion.

⚫

Auto reload function.

⚫

Programmable counter repetition function.

⚫

Break input .

Doc ID 2905025

Rev01

173

WB32FQ95xx Reference Manual

⚫

15.3.

Interrupt output or DMA request on:
◼

update

◼

trigger event

◼

compare/capture event

◼

break input

⚫

Daisy chaining of timer modules allows a single timer to initiate multiple timers .

⚫

Timer synchronization allows selected timers to start counting on the same clock cycle.

⚫

Timer Master/Slave mode controller.

Block diagram
Figure 16-1. Advanced timer block diagram provides the details of the internal
configuration of the advanced timer.
Figure 15-1. Advanced timer block diagram

Doc ID 2905025

Rev01

174

WB32FQ95xx Reference Manual

15.4.

Function overview

15.4.1.

Clock selection
The advanced timer has the capability of being clocked by either the TIMER_CK or an
alternate clock source controlled by SMS (TIMx_SMCR bit [2:0]).
⚫

SMS [2:0] == 3’b000. Internal clock CK_TIMER is selected as timer clock source which
is from module RCC .

The default clock source is the CK_TIMER for driving the counter prescaler when the slave
mode is disabled (SMS [2:0] == 3’b000). When the CEN is set, the CK_TIMER will be divided
by PSC value to generate PSC_CLK .
In this mode, the TIMER_CK, which drives counter’s prescaler to count, is equal to
CK_TIMER which is from RCC.
If the slave mode controller is enabled by setting SMS [2:0] in the TIMx_SMCR register to an
available value including 0x1, 0x2, 0x3 and 0x7, the prescaler is clocked by other clock
sources selected by the TS[2:0] in the TIMx_SMCR register , details as follows. When the
slave mode selection bits SMS[2:0] are set to 0x4, 0x5 or 0x6, the internal clock TIMER_CK
is the counter prescaler driving clock source.
Figure 15-2. Normal mode, internal clock divided by 1

⚫

SMS[2:0] == 3’b111 (external clock mode 1). External input pin is selected as timer clock
Source.

The TIMER_CK, which drives counter’s prescaler to count, can be triggered by the event of
rising or falling edge on the external pin TIMx_CH1/TIMx_CH2. This mode can be selected
by setting SMS[2:0] to 0x7 and the TS[2:0] to 0x4, 0x5 or 0x6.
And, the counter prescaler can also be driven by rising edge on the internal trigger input pin
ITR0/1/2/3. This mode can be selected by setting SMS [2:0] to 0x7 and the TS [2:0] to 0x0,
0x1, 0x2 or 0x3.
⚫

ECE== 1’b1 (external clock mode 2). External input is selected as timer clock source
(ETR).

The TIMER_CK, which drives counter’s prescaler to count, can be triggered by the event of
Doc ID 2905025

Rev01

175

WB32FQ95xx Reference Manual

rising or falling edge on the external pin ETR . This mode can be selected by setting the ECE
bit in the TIMx_SMCR register to 1. The other way to select the ETR signal as the clock
source is to set the SMS [2:0] to 0x7 and the TS [2:0] to 0x7 respectively. Note that the ETR
signal is derived from the ETR pin sampled by a digital filter. When the ETR signal is selected
as clock source, the trigger controller including the edge detection circuitry will generate a
clock pulse on each ETR signal rising edge to clock the counter prescaler.

15.4.2.

Prescaler
The prescaler can divide the timer clock (TIMER_CK) to a counter clock (PSC_CLK) by any
factor between 1 and 65536. It is controlled by prescaler register (TIMx_PSC) which can be
changed on the go but is taken into account at the next update event.
Figure 15-3. Counter timing diagram with prescaler division change from 1 to 4

15.4.3.

Up counting mode
In this mode, the counter counts up continuously from 0 to the counter-reload value, which is
defined in the TIMx_ARR register, in a count-up direction. Once the counter reaches the
counter reload value, the counter restarts from 0. If the repetition counter is set, the update
events will be generated after (TIMx_RCR+1) times of overflow. Otherwise the update event
is generated each time when overflows. The counting direction bit DIR in the TIMx_CR1
register should be set to 0 for the up counting mode.
Whenever, if the update event software trigger is enabled by setting the UG bit in the
TIMx_EGR register, the counter value will be initialized to 0 and generates an update event.
If set the UDIS bit in TIMx_CR1 register, the update event is disabled.
When an update event occurs, all the registers (repetition counter, auto reload register,
prescaler register) are updated.
The following figures show some examples of the counter behavior for different clock
prescaler factor when TIMx_ARR=0x36.

Doc ID 2905025

Rev01

176

WB32FQ95xx Reference Manual

Figure 15-4. Up-counter timechart, PSC=0

Figure 15-5. Up-counter timechart, PSC=1

Figure 15-6. Up-counter timechart, PSC=3

Doc ID 2905025

Rev01

177

WB32FQ95xx Reference Manual

Figure 15-7. Up-counter timechart, PSC=N

Figure 15-8. Up-counter timechart, change TIMx_ARR on the go

15.4.4.

Down counting mode
In this mode, the counter counts down continuously from the counter-reload value, which is
defined in the TIM1_ARR register, to 0 in a count-down direction. Once the counter reaches
to 0, the counter restarts to count again from the counter-reload value. If the repetition
counter is set, the update event will be generated after (TIMx_RCR+1) times of underflow.
Otherwise the update event is generated each time when underflows. The counting direction
bit DIR in the TIMx_CR1 register should be set to 1 for the down-counting mode.
When the update event is set by the UG bit in the TIMx_EGR register, the counter value will
be initialized to the counter-reload value and generates an update event.
If set the UDIS bit in TIMx_CR1 register, the update event is disabled.

Doc ID 2905025

Rev01

178

WB32FQ95xx Reference Manual

When an update event occurs, all the registers (repetition counter, auto reload register,
prescaler register) are updated.
The following figures show some examples of the counter behavior in different clock
frequencies when TIMx_ARR=0x36.
Figure 15-9. Down-counter timechart, PSC=0

Figure 15-10. Down-counter timechart, PSC=1

Figure 15-11. Down-counter timechart, PSC=3

Doc ID 2905025

Rev01

179

WB32FQ95xx Reference Manual

Figure 15-12. Down-counter timechart, PSC=N

Figure 15-13. Down-counter timechart, change TIMx_ARR on the go (APRE=0)

15.4.5.

Center-aligned counting mode
In the center-aligned counting mode, the counter counts up from 0 to the counter-reload
value and then counts down to 0 alternatively. The Timer module generates an overflow
event when the counter counts to the counter-reload value subtract 1 in the up-counting
direction and generates an underflow event when the counter counts to 1 in the
down-counting direction. The counting direction bit DIR in the TIMx_CR1 register is

Doc ID 2905025

Rev01

180

WB32FQ95xx Reference Manual

read-only and indicates the counting direction when in the center-aligned mode. The
counting direction is updated by hardware automatically.
Setting the UG bit in the TIMx_EGR register will initialize the counter value to 0 and
generates an update event irrespective of whether the counter is counting up or down in the
center-align counting mode.
The UIF bit in the TIMx_SR register can be set to 1 either when an underflow event or an
overflow event occurs. While the CCxIF bit is associated with the value of CMS in TIMx_CR1.
Refer to Figure 16-14 for the details.
If set the UDIS bit in the TIMx_CR1 register, the update event is disabled.
When an update event occurs, all the registers (repetition counter, auto-reload register,
prescaler register) are updated.
The figures below show some examples of the counter behavior for different clock
frequencies.
Figure 15-14. Center-aligned counter timechart, PSC=0

Figure 15-15. Center-aligned counter timechart, PSC=1

Doc ID 2905025

Rev01

181

WB32FQ95xx Reference Manual

Figure 15-16. Center-aligned counter timechart, PSC=3

Figure 15-17. Center-aligned counter timechart, PSC=N

Figure 15-18. Center-aligned counter timechart, update event with ARPE=1 (counter underflow)

Doc ID 2905025

Rev01

182

WB32FQ95xx Reference Manual

Figure 15-19. Center-aligned counter timechart, update event with ARPE=1 (counter overflow)

15.4.6.

Counter repetition
Counter Repetition is used to generate update event or updates the timer registers only after
a given number (N+1) of cycles of the counter, where N is REP in TIMx_RCR register. The
repetition counter is decremented at each counter overflow in up-counting mode, at each
counter underflow in down-counting mode or at each counter overflow and at each counter
underflow in center-aligned mode.
Setting the UG bit in the TIMx_EGR register will reload the content of REP in TIMx_RCR
register and generate an update event.
For odd values of REP in center-aligned mode, the update event occurs either on the
overflow or on the underflow depending on when the REP register was written and when the
counter was started. The update event is generated at overflow when the REP was written
before starting the counter, and generated at underflow when the REP was written after
starting the counter.
Figure 15-20. Repetition time chart for center-aligned counter

Doc ID 2905025

Rev01

183

WB32FQ95xx Reference Manual

15.4.7.

Capture/compare channels
The advanced timer has four independent channels which can be used as capture inputs or
compare match outputs. Each channel is built around a channel capture compare register
including an input stage, channel controller and an output stage.
⚫

Input capture mode

Capture mode allows the channel to perform measurements such as pulse timing, frequency,
period, duty cycle and so on. The input stage consists of a digital filter, a channel polarity
selection, edge detection and a channel prescaler. When a selected edge occurs on the
channel input, the current value of the counter is captured into the TIMx_CCRx register, at
the same time the CCxIF bit is set and the channel interrupt is generated if enabled by CCxIE
= 1.
Figure 15-21. Input capture logic

One of channels’ input signals (TIx) can be chosen from the TIMx_CHx signal or the
Excusive-OR function of the TIMx_CH1, TIMx_CH2 and TIMx_CH3 signals. First, the
channel input signal (TIx) is synchronized to TIMER_CK domain, and then sampled by a
digital filter to generate a filtered input signal. Then through the edge detector, the rising and
falling edge are detected. You can select one of them by CCxP. One more selector is for the
other channel and trig, controlled by CCxS. The IC_prescaler make several the input event
generate one effective capture event. On the capture event, CCRx will restore the value of
Counter.
So the process can be divided to several steps as below:
Step1:

Filter configuration. (ICxF in TIMx_CCMR1)
Based on the input signal and requested signal quality, configure compatible ICxF.

Step2:

Edge selection. (CCxP/CCxNP in TIMx_CCER)
Rising or falling edge, choose one by CCxP/CCxNP .

Step3:

Capture source selection. (CCxS in TIMx_CCMR1)
As soon as you select one input capture source by CCxS, you have set the channel
to input mode (CCxS != 0x0) and TIMx_CCRx cannot be written any more.

Step4:

Interrupt enable. (CCxIE and CCxDE in TIMx_DIER)
Enable the related interrupt enable; you can got the interrupt and DMA request.

Step5:

Capture enables. (CCxE in TIMx_CCER)

Result: when your wanted input signal is got, TIMx_CCRx will be set by counter’s value.
And CCxIF is also asserted. If the CCxIF has been high, the CCxOF will also be
asserted. The interrupt and DMA request will be asserted based on the
configuration of CCxIE and CCxDE in TIMx_DIER.

Doc ID 2905025

Rev01

184

WB32FQ95xx Reference Manual

Direct generation: if you want to generate a DMA request or Interrupt, you can set CCxG by
software directly.
The input capture mode can also be used for pulse width measurement from signals on the
TIMx_CHx pins. For example, PWM signal connect to TI1 input. Select Channel 1 capture
signals to TI1 by setting CC1S to 2’b01 in the channel control register (TIMx_CCMR1) and
set capture on rising edge. Select Channel 2 capture signal to TI1 by setting CC2S to 2’b10
in the channel control register (TIMx_CCMR1) and set capture on falling edge. The counter
set to restart mode and restart on Channel 1 rising edge. Then the TIMx_CCR1 can measure
the PWM period and the TIMx_CCR2 can measure the PWM duty.
⚫

Output compare mode

In output compare mode, the TIMx can generate timed pulses with programmable position,
polarity, duration and frequency. When the counter matches the value in the CCRx register of
an output compare channel, the channel (n) output can be set, cleared, or toggled based on
OCxM . When the counter reaches the value in the CCRx register, the CCxIF bit is set and
the channel (n) interrupt is generated if CCxIE = 1. And the DMA request will be asserted, if
CCxDE = 1.
So the process can be divided to several steps as below:
Step1:

Clock Configuration. Such as clock source, clock prescaler and so on.

Step2:

Compare mode configuration.
* Set the shadow enable mode by OCxPE
* Set the output mode (Set/Clear/Toggle) by OCxM .
* Select the active high polarity by CCxP/CCxNP
* Enable the output by CCxE

Step3:

Interrupt/DMA-request enables configuration by CCxIE/CCxDE.

Step4:

Compare output timing configuration by TIMx_ARR and TIMx_CCRx
About the CCRx; you can change it on the go to meet the waveform you expected.

Step5:

Start the counter by setting CEN.

The timechart below shows the output compare mode in detail.
Figure 15-22. Output-compare mode, toggle on OC1.

Doc ID 2905025

Rev01

185

WB32FQ95xx Reference Manual

15.4.8.

PWM mode
In the output PWM mode (by setting the OCxM bits to 3’b110 (PWM mode1) or to 3’b
111(PWM mode2), the channel can generate PWM waveform according to the TIMx_ARR
registers and TIMx_CCRx registers.
Based on the counter mode, we can also divide PWM into EAPWM (Edge aligned PWM) and
CAPWM (Centre aligned PWM).
The EAPWM period is determined by TIMx_ARR and duty cycle is determined by
TIMx_CCRx. The Figure below shows the EAPWM output and interrupts waveform.
Figure 15-23. EAPWM waveforms (ARR=8)

The CAPWM period is determined by 2*TIMx_ARR, and duty cycle is by 2*TIMx_CCRx. The
figure below shows the CAPWM output and interrupts waveform.
Figure 15-24. CAPWM waveforms (ARR=8)

Doc ID 2905025

Rev01

186

WB32FQ95xx Reference Manual

If TIMx_CCRx is greater than TIMx_ARR , the output will be always active under PWM
mode1 (OCxM = 3’b110).
And if TIMx_CCRx is equal to zero, the output will be always inactive under PWM mode1
(OCxM = 3’b110)

15.4.9.

Channel output reference signal
When the TIMx is used in the compare match output mode, the OxCPRE signal (Channel x
Output prepare signal) is defined by setting the OCxM filed. The OxCPRE signal has several
types of output function. These include, keeping the original level by setting the OCxM field
to 0x00, set to 1 by setting the OCxM field to 0x01, set to 0 by setting the OCxM field to 0x02
or signal toggle by setting the OCxM field to 0x03 when the counter value matches the
content of the TIMx_CCRx register.
The PWM mode 1 and PWM mode 2 outputs are also another kind of OxCPRE output which
is setup by setting the OCxM field to 0x06/0x07. In these modes, the OxCPRE signal level is
changed according to the counting direction and the relationship between the counter value
and the TIMx_CCRx content. With regard to a more detail description refer to the relative bit
definition.
Another special function of the OxCPRE signal is a forced output which can be achieved by
setting the OCxM field to 0x04/0x05. Here the output can be forced to an inactive/active level
irrespective of the comparison condition between the counter and the TIMx_CCRx values.
The OxCPRE signal can be forced to 0 when the ETRF signal is derived from the external
ETR pin and when it is set to a high level by setting the OCxCE bit to 1 in the TIMx_CCMR1
register. The OxCPRE signal will not return to its active level until the next update event
occurs.

15.4.10.

Outputs complementary
Function of complementary is for a pair of CHx_O and CHx_ON. Those two output signals
cannot be active at the same time. The TIMx has 4 channels, but only the first three channels
have this function. The complementary signals CHx_O and CHx_ON are controlled by a
group of parameters: the CCxE and CCxNE bits in the TIMx_CCER register and the MOE,
OSSR, OSSI, ISOx and ISOxN bits in the TIMx_BDTR and TIMx_CR2 registers. The outputs
polarity is determined by CCxP and CCxNP bits in the TIMx_CCER register.
Table 15-1. Complementary outputs controlled by parameters

Complementary Parameters
MOE

OSSR

OSSI

CCxE

Output Status
CCxNE
0

0
1
0
0

0/1

0
1
1
1

Doc ID 2905025

0

0

CHx_O_

CHx ON_

CHx_O / CHx_ON = LOW
CHx_O / CHx_ON output disable.
CHx_O = CCxP, CHx_ON = CCxNP
CHx_O/CHx_ON output disable.
If clock is enable:
CHx_O = ISOx, CHx_ON = ISOxN
CHx_O = CCx, CHx_ON = CCxNP
CHx_O/CHx_ON output disable.

Rev01

187

WB32FQ95xx Reference Manual

Complementary Parameters
MOE

OSSR

OSSI

CCxE

Output Status
CCxNE
1
0

1
1

CHx_O = CCxP CHx_ON = CCxNP
CHx_O/CHx_ON output enable.
If clock is enable:
CHx_O = ISOx, CHx_ON = ISOxN
CHx_O/CHx_ON = LOW
CHx_O/CHx_ON output disable.

1

CHx_O = LOW
CHx_O output disable.

0

CHx_O=OxCPRE⊕CCxP

1

CHx_O output enable
CHx_O=OxCPRE⊕CCxP

0
1

CHx_ON=OxCPRE⊕CCxNP
CHx_ON output enable
CHx_ON = LOW
CHx_ON output disable.
CHx_ON=OxCPRE⊕CCxNP

0

CHx_O output enable
CHx_O = CCxP
CHx_O output disable.

CHx_ON output enable
CHx_ON = CCxNP
CHx_ON output disable.

1

CHx_O = CCxP
CHx_O output enable

CHx_ON=OxCPRE⊕CCxNP

0

CHx_O=OxCPRE⊕CCxP

1

CHx_O output enable
CHx_O=OxCPRE⊕CCxP

0/1
0
1
1

CHx_O output enable

15.4.11.

CHx ON_

0
0

1

CHx_O_

CHx_ON output enable
CHx_ON = CCxNP
CHx_ON output enable.
CHx_ON=OxCPRE⊕CCxNP
CHx_ON output enable.

Dead time insertion
The dead time insertion is enabled when both CCxE and CCxNE are 1’b1, and set MOE is
also necessary. The field named DTG defines the dead time delay that can be used for all
channels expect for Channel 4. The detail about the delay time, refer to the register
TIMx_BDTR
The dead time delay insertion ensures that no two complementary signals drive the active
state at the same time.
When the channel (x) match (TIMx counter = CCRx) occurs, OxCPRE will be toggled
because under PWM1 mode. At point A in the figure 16-25, CHx_O signal remains at the low
value until the end of the deadtime delay, while CHx_ON will be cleared at once.
Similarly, at point B when counter match (counter = CCRx) occurs again, OxCPRE is cleared,
CHx_O signal will be cleared at once, while CHx_ON signal remains at the low value until the
end of the dead time delay.
Sometimes, we can see corner cases about the dead time insertion. For example:
The dead time delay is greater than or equal to the CHx_O duty cycle, then the CHx_O
signal is always the inactive value (as show in the figure 16-25).

Doc ID 2905025

Rev01

188

WB32FQ95xx Reference Manual

Figure 15-25. Complementary output with dead-time insertion

15.4.12.

Break function
In this function, the output CHx_O and CHx_ON are controlled by the MOE, OSSI and OSSR
bits in the TIMx_BDTR register, ISOx and ISOxN bits in the TIMx_CR2 register and cannot
be set both to active level when break occurs. The break sources are input break pin and
HSE stuck event by Clock Monitor (CCS) in RCC. The break function enabled by setting the
BKE bit in the TIMx_BDTR register. The break input polarity is setting by the BKP bit in
TIMx_BDTR.
When a break occurs, the MOE bit is cleared asynchronously, the output CHx_O and
CHx_ON are driven with the level programmed in the ISOx bit and ISOxN in the TIMx_CR2
register as soon as MOE is 0. If OSSI is 0 then the timer releases the enable output else the
enable output remains high. The complementary outputs are first put in reset state, and then
the dead-time generator is reactivated in order to drive the outputs with the level
programmed in the ISOx and ISOxN bits after a dead-time.
When a break occurs, the BIF bit in the TIMx_SR register is set. If BIE is 1, an interrupt
generated.

Doc ID 2905025

Rev01

189

WB32FQ95xx Reference Manual

Figure 15-26. Output behavior in response to a break (The break high active)

15.4.13.

Quadrature decoder
The quadrature decoder function uses two quadrature inputs TI1 and TI2 derived from the
TIMx_CH1 and TIMx_CH2 pins respectively to interact to generate the counter value. The
DIR bit is modified by hardware automatically during each input source transition. The input
source can be either TI1 only, TI2 only or both TI1 and TI2, the selection mode by setting the
SMS [2:0] to 0x01, 0x02 or 0x03. The mechanism for changing the counter direction is
shown in the following table. The quadrature decoder can be regarded as an external clock
with a directional selection. This means that the counter counts continuously in the interval
between 0 and the counter-reload value. Therefore, users must configure the TIMx_ARR
register before the counter starts to count.
Table 15-2. Counting direction versus encoder signals
TI1FP1

Counting mode

TI1 only
counting
TI2 only
counting

TI1 and TI2
counting

TI2FP2

Level
Rising

Falling

Rising

Falling

TI2FP2=High

Down

Up

-

-

TI2FP2=Low

Up

Down

-

-

TI1FP1=High

-

-

Up

Down

TI1FP1=Low

-

-

Down

Up

TI2FP2=High

Down

Up

X

X

TI2FP2=Low

Up

Down

X

X

TI1FP1=High

X

X

Up

Down

TI1FP1=Low

X

X

Down

Up

Note:"-" means "no counting"; "X" means impossible.

Doc ID 2905025

Rev01

190

WB32FQ95xx Reference Manual

Figure 15-27. Example of counter operation in encoder interface mode

Figure 15-28. Example of encoder interface mode with CI1FE0 polarity inverted

15.4.14.

Hall sensor function
Hall sensor is generally used to control BLDC Motor; advanced timer can support this
function.
Figure 16-29 shows how to connect. And we can see we need two timers. First TIMER in
(General purpose TIMER) should accept three Rotor Position signals from Motor.
Each of the 3 sensors provides a pulse that applied to an input capture pin, can then be
analyzed and both speed and position can be deduced.
By the internal connection such as TRGO- ITIx, TIMER_in and TIMER_out can be connected.
TIMER_out will generate PWM signal to control BLDC motor’s speed based on the ITRx.
Then, the feedback circuit is finished, also you change configuration to fit your request.
About the TIMER_in, it need have input XOR function, so you can choose from Advanced
TIMER.
And TIMER_out need have functions of complementary and Dead-time, so only advanced
timer can be chosen. Else, based on the timers’ internal connection relationship, pair’s timers
can be selected. For example:

Doc ID 2905025

Rev01

191

WB32FQ95xx Reference Manual

TIMER_in (TIMER2) -> TIMER_out (Timer1 ITR1)
And so on.
After getting appropriate timers combination, and wire connection, we need to configure
timers. Some key settings include:
⚫

Enable XOR by setting TI1S, then, each of input signal change will make the TI1 toggle.
CCR1 will record the value of counter at that moment.

⚫

Enable ITRx connected to commutation function directly by setting CCUS and CCPC.

⚫

Configuration PWM parameter based on your request.
Figure 15-29. Hall sensor is used to BLDC motor

Figure 15-30. Hall sensor timing between two timers

Slave controller

The TIMx can be synchronized with a trigger in several modes including the restart mode,

Doc ID 2905025

Rev01

192

WB32FQ95xx Reference Manual

the pause mode and the event mode which is selected by the SMS [2:0] in the TIMx_SMCR
register. The trigger input of these modes can be selected by the TS [2:0] in the TIMx_SMCR
register.

15.4.15.

Single pulse mode
Single pulse mode is opposite to the repetitive mode, which can be enabled by setting OPM
in TIMx_CR1. When you set OPM, the counter will be clear and stop when the next update
event automatically. In order to get pulse waveform, you can set the TIMx to PWM mode or
compare by OCxM .
Once the timer is set to operate in the single pulse mode, it is not necessary to set the timer
enable bit CEN in the TIMx_CR1 register to 1 to enable the counter. The trigger to generate a
pulse can be sourced from the trigger signals edge or by setting the CEN bit to 1 using
software. Setting the CEN bit to 1 or a trigger from the trigger signals edge can generate a
pulse and then keep the CEN bit at a high state until the update event occurs or the CEN
bit is written to 0 by software. If the CEN bit is cleared to 0 using software, the counter will be
stopped and its value held. If the CEN bit is automatically cleared to 0 by a hardware update
event, the counter will be reinitialized.
In the single pulse mode, the trigger active edge which sets the CEN bit to 1 will enable the
counter. However, there exist several clock delays to perform the comparison result between
the counter value and the TIMx_CCRx value. In order to reduce the delay to a minimum
value, the user can set the OCxFE bit in each TIMx_CCMR1/1 register. After a trigger rising
occurs in the single pulse mode, the OxCPRE signal will immediately be forced to the state
which the OxCPRE signal will change to, as the compare match event occurs without taking
the comparison result into account. The OCxFE bit is available only when the output channel
is configured to operate in the PWM1 or PWM2 output mode and the trigger source is
derived from the trigger signal.
Figure 15-31. Single pulse mode, TIMx_CCRx = 0x04, TIMx_ARR=0x60

15.4.16.

Timers interconnection
The timers can be internally connected together for timer chaining or synchronization. This
can be implemented by configuring one timer to operate in the master mode while
configuring another timer to be in the slave mode. The following figures present several
examples of trigger selection for the master and slave modes.
Figure 16-32. Timer1 master/slave mode timer example shows the timer1 trigger

Doc ID 2905025

Rev01

193

WB32FQ95xx Reference Manual

selection when it is configured in slave mode.
Figure 15-32. Timer1 master/slave mode timer example

⚫

Other interconnection examples:
◼

Timer 2 as prescaler for timer 1
We configure Timer2 as a prescaler for Timer 1. Refer to Figure 16-32. Timer1
master/ slave mode timer example for connections. Do as bellow:

◼

◆

Configure Timer2 in master mode and select its update event (UPE) as trigger
output (MMS=3’b010 in the TIMER2_CR2 register). Then timer2 drives a
periodic signal on each counter overflow.

◆

Configure the Timer2 period (TIMER2_ARR registers).

◆

Select the Timer1 input trigger source from Timer2 (TS=3’b010 in the
TIMx_SMCR register).

◆

Configure Timer1 in external clock mode 1 (SMS=3’b111 in TIMx_SMCR
register).

◆

Start Timer1 by writing ‘1 in the CEN bit (TIM1 _CR1 register).

◆

Start Timer2 by writing ‘1 in the CEN bit (TIMER2_CR1 register).

Start Timer1 with Timer2’s Enable/Update signal

In this example , we enable Timer1 with the enable output of Timer2. Refer to Figure 16-33.
Triggering Timer1 with enable signal of TIMER2. Timer1 starts counting from its current
value on the divided internal clock after trigger by Timer2 enable output.
When Timer1 receives the trigger signal, its CEN bit is set automatically and the counter
counts until we disable TIM1 . In this example, both counter clock frequencies are divided by
3 by the prescaler compared to TIMER_CK (fCNT_CLK = fTIMER_CK/3) . TIM1 ’s SMS is set as
event mode, so Timer1 can not be disabled by Timer2’s disable signal . Do as follow:

Doc ID 2905025

◆

Configure Timer2 master mode to send its enable signal as trigger
output(MMS=3’b001 in the TIMER2_CR2 register)

◆

Configure Timer1 to select the input trigger from Timer2 (TS=3’b010 in the
TIMx_SMCR register).
Rev01

194

WB32FQ95xx Reference Manual

◆

Configure Timer1 in event mode (SMS=3’b110 in TIMx_SMCR register).

◆

Start Timer2 by writing 1 in the CEN bit (TIMER2_CR1 register).

Figure 15-33. Triggering Timer1 with enable signal of TIMER2

In this example, we also can use update Event as trigger source instead of enable signal.
Refer to Figure 16-34. Triggering Timer1 with update signal of TIMER2. Do as follow:
◆

Configure Timer2 in master mode and send its update event (UPE) as trigger
output (MMS=3’b010 in the TIMER2_CR2 register).

◆

Configure the Timer2 period (TIMER2_ARR registers).

◆

Configure Timer1 to get the input trigger from Timer2 (TS=3’b010 in the
TIMx_SMCR register).

◆

Configure Timer1 in event mode (SMS=3’b110 in TIMx_SMCR register).

◆

Start Timer2 by writing ‘1 in the CEN bit (TIMER2_CR1 register).

Figure 15-34. Triggering Timer1 with update signal of TIMER2

Doc ID 2905025

Rev01

195

WB32FQ95xx Reference Manual

◼

Enable Timer1 count with Timer2’s enable/O1CPRE signal

In this example, we control the enable of Timer1 with the enable output of Timer2 .Refer to
Figure 16-35. Pause Timer1 with enable signal of TIMER2. Timer1 counts on the divided
internal clock only when Timer 2 is enable. Both counter clock frequencies are divided by 3
by the prescaler compared to CK_TIMER (fCNT_CLK = fPCLK /3). TIM1 ’s SMS is set as pause
mode, so Timer1 can be enabled/disabled by Timer2’s enable/disable signal. Do as follow:
◆

Configure Timer2 input master mode and output enable signal as trigger
output (MMS=3’b001 in the TIMER2_CR2 register).

◆

Configure Timer1 to get the input trigger from Timer2 (TS=3’b010 in the
TIMx_SMCR register).

◆

Configure Timer1 in pause mode (SMS=3’b101 in TIMx_SMCR register).

◆

Enable Timer1 by writing ‘1 in the CEN bit (TIM1 _CR1 register)

◆

Start Timer2 by writing ‘1 in the CEN bit (TIMER2_CR1 register).

◆

Stop Timer2 by writing ‘0 in the CEN bit (TIMER2_CR1 register).

Figure 15-35. Pause Timer1 with enable signal of TIMER2

In this example, we also can use O1CPRE as trigger source instead of enable signal output.
Do as follow:

Doc ID 2905025

◆

Configure Timer2 in master mode and output 0 Compare Prepare signal
(O1CPRE ) as trigger output (MMS=3’b100 in the TIMER2_CR2 register).

◆

Configure the Timer2 O1CPRE waveform (TIMER2_CCMR1 register).

◆

Configure Timer1 to get the input trigger from Timer2 (TS=3’b010 in the
TIMx_SMCR register).

◆

Configure Timer1 in pause mode (SMS=3’b101 in TIMx_SMCR register).

◆

Enable Timer1 by writing ‘1 in the CEN bit (TIM1 _CR1 register).

◆

Start Timer2 by writing ‘1 in the CEN bit (TIMER2_CR1 register).

Rev01

196

WB32FQ95xx Reference Manual

Figure 15-36. Pause Timer1 with O1CPREF signal of Timer2

◼

Using an external trigger to start 2 timers synchronously

We configure the start of Timer1 triggered by the enable signal of Timer2, and Timer2 is
triggered by its TI1 input rises edge. To ensure 2 timers start synchronously, Timer2 must be
configured in Master/Slave mode. Do as follow:
◆

Configure Timer2 in slave mode to get the input trigger from TI1 (TS=3’b100 in
the TIMER2_SMCR register).

◆

Configure Timer2 in event mode (SMS=3’b110 in the TIMER2_SMCR
register).

◆

Configure the Timer2 in Master/Slave mode by writing MSM=1 (TIMER2_
SMCR register).

◆

Configure Timer1 to get the input trigger from Timer2 (TS=3’b010 in the
TIMx_SMCR register).

◆

Configure Timer1 in event mode (SMS=3’b110 in the TIM1 _SMCR register).

When a rising edge occurs on Timer2’s TI1, two timer’s counters start counting
synchronously on the internal clock and both TIF flags are set.
Figure 15-37. Triggering Timer1 and TIMER2 with TIMER2’s TI1 input

Doc ID 2905025

Rev01

197

WB32FQ95xx Reference Manual

15.4.17.

Timer DMA mode
If one of the DMA request event coming, TIMx will send DMA requests to DMAC. The user
can configure DMAC properly and read/write TIMx SFRs under the control of DMA. Please
refer to DMAC related chapters for details.

15.4.18.

Timer debug mode
When the Cortex™-M3 is halted, and the DBG_TIMx_STOP configuration bit in
DBGMCU_CR register is set to 1, the TIMx counter stops.

15.5.

Register definition

15.5.1.

Control register 1 (TIMx_CR1)
Address offset: 0x00
Reset value: 0x0000

Bits

Fields

R/W

31:10

Reserved

R

9:8

CKD[1:0]

RW

7

ARPE

RW

6:5

CMS[1:0]

RW

4

DIR

RW

Doc ID 2905025

Description
Must be kept at reset value
Clock division
The CKD bits can be configured by software to specify division ratio between the
timer clock (TIMER_CK) and the dead-time and sampling clock (DTS), which is
used by the dead-time generators and the digital filters.
00: fDTS=fTIMER_CK
01: fDTS=fTIMER_CK /2
10: fDTS=fTIMER_CK /4
11: Reserved
Auto-reload shadow enable
0: The shadow register for TIMx_ARR register is disabled
1: The shadow register for TIMx_ARR register is enabled
Counter aligns mode selection
00: No center-aligned mode (edge-aligned mode). The direction of the counter is
specified by the DIR bit.
01: Center-aligned and counting down assert mode. The counter counts under
center-aligned and channel is configured in output mode (CCxS=00 in
TIMx_CCMR1 register). Only when the counter is counting down, compare
interrupt flag of channels can be set.
10: Center-aligned and counting up assert mode. The counter counts under
center-aligned and channel is configured in output mode (CCxS=00 in
TIMx_CCMR1 register). Only when the counter is counting up, compare interrupt
flag of channels can be set.
11: Center-aligned and counting up/down assert mode. The counter counts under
center-aligned and channel is configured in output mode (CCxS=00 in
TIMx_CCMR1 register). Both when the counter is counting up and counting
down, compare interrupt flag of channels can be set.
After the counter is enabled, cannot be switched from 0x00 to non 0x00.
Direction
0: Count up
1: Count down
This bit is read only when the timer is configured in center-aligned mode or
encoder mode.

Rev01

198

WB32FQ95xx Reference Manual

Bits

Fields

R/W

3

OPM

RW

2

URS

RW

1

UDIS

RW

0

CEN

RW

15.5.2.

Description
Single pulse mode.
0: Single pulse mode disable. Counter continues after update event.
1: Single pulse mode enable. The CEN is cleared by hardware and the counter
stops at next update event.
Update source
This bit is used to select the update event sources by software.
0: Any of the following events generate an update interrupt or DMA request:
– The UG bit is set
– The counter generates an overflow or underflow event
– The slave mode controller generates an update event.
1: Only counter overflow/underflow generates an update interrupt or DMA request.
Update disable.
This bit is used to enable or disable the update event generation.
0: update event enable. The update event is generate and the buffered registers
are loaded with their preloaded values when one of the following events occurs:
– The UG bit is set
– The counter generates an overflow or underflow event
– The slave mode controller generates an update event.
1: update event disable. The buffered registers keep their value, while the counter
and the prescaler are reinitialized if the UG bit is set or if the slave mode controller
generates a hardware reset event.
Counter enable
0: Counter disable
1: Counter enable
The CEN bit must be set by software when timer works in external clock, pause
mode and encoder mode. While in event mode, the hardware can set the CEN bit
automatically.

Control register 2 (TIMx_CR2)
Address offset: 0x04
Reset value: 0x0000

Bits

Fields

RW

31-15

Reserved

R

14

OIS4

RW

13

OIS3N

RW

12

OIS3

RW

11

OIS2N

RW

10

OIS2

RW

9

OIS1N

RW

8

OIS1

RW

Doc ID 2905025

Descriptions
Must be kept at reset value
Idle state of Channel 4 output
Refer to OIS1 bit
Idle state of Channel 3 complementary output
Refer to OIS1N bit
Idle state of Channel 3 output
Refer to OIS1 bit
Idle state of Channel 2 complementary output
Refer to OIS1N bit
Idle state of Channel 2 output
Refer to OIS1 bit
Idle state of Channel 1 complementary output
0: When MOE bit is reset, CH1_ON is set low.
1: When MOE bit is reset, CH1_ON is set high
This bit can be modified only when LOCK [1:0] bits in TIMx_BDTR register is 00.
Idle state of Channel 1 output
0: When MOE bit is reset, CH1_O is set low.

Rev01

199

WB32FQ95xx Reference Manual

Bits

Fields

RW

Descriptions
1: When MOE bit is reset, CH1_O is set high
The CH1_O output changes after a dead-time if CH1_ON is implemented. This bit
can be modified only when LOCK [1:0] bits in TIMx_BDTR register is 00.
Channel 1 trigger input selection
0: The TIMx_CH1 pin input is selected as Channel 1 trigger input.
1: The result of combinational XOR of TIMx_CH1, CH2 and CH3 pins is selected
as Channel 1 trigger input.
Master mode control
These bits control the selection of TRGO signal, which is sent in master mode to
slave timers for synchronization function.
000: Reset. When the UG bit in the TIMx_EGR register is set or a reset is
generated by the slave mode controller, a TRGO pulse occurs. And in the latter
case, the signal on TRGO is delayed compared to the actual reset.
001: Enable. This mode is useful to start several timers at the same time or to
control a window in which a slave timer is enabled. In this mode the master mode
controller selects the counter enable signal as TRGO. The counter enable signal
is set when CEN control bit is set or the trigger input in pause mode is high. There
is a delay between the trigger input in pause mode and the TRGO output, except if
the master-slave mode is selected.
010: Update. In this mode the master mode controller selects the update event as
TRGO.
011: Capture/compare pulse. In this mode the master mode controller generates a
TRGO pulse when a capture or a compare match occurred in channal0.
100: Compare. In this mode the master mode controller selects the O1CPRE
signal is used as TRGO
101: Compare. In this mode the master mode controller selects the O2CPRE
signal is used as TRGO
110: Compare. In this mode the master mode controller selects the O3CPRE
signal is used as TRGO
111: Compare. In this mode the master mode controller selects the O4CPRE
signal is used as TRGO
DMA request source selection
0: DMA request of channel x is sent when capture/compare event occurs.
1: DMA request of channel x is sent when update event occurs.
Commutation control shadow register update control
When the commutation control shadow enable (for CCxE , CCxNE and OCxM
bits) are set (CCPC=1), these shadow registers update are controlled as below:
0: The shadow registers update by when COMG bit is set.
1: The shadow registers update by when COMG bit is set or a rising edge of TRGI
occurs.
When a channel does not have a complementary output, this bit has no effect.

7

TI1S

RW

6:4

MMS[2:0]

RW

3

CCDS

RW

2

CCUS

RW

1

Reserved

R

Must be kept at reset value.

RW

Commutation control shadow enable
0: The shadow registers for CCxE, CCxNE and OCxM bits are disabled.
1: The shadow registers for CCxE, CCxNE and OCxM bits are enabled. After
these bits have been written, they are updated based when commutation event
coming.
When a channel does not have a complementary output, this bit has no effect.

0

15.5.3.

CCPC

Slave mode configuration register (TIMx_SMCR)
Address offset: 0x08

Doc ID 2905025

Rev01

200

WB32FQ95xx Reference Manual

Reset value: 0x0000
Bits

Fields

RW

31-16

-

R

15

ETP

RW

14

ECE

RW

13:12

ETPS[1:0]

RW

11:8

ETF[3:0]

RW

7

MSM

RW

Doc ID 2905025

Descriptions
Reserved bits
External trigger polarity
This bit specifies the polarity of ETR signal
0: ETR is active at high level or rising edge.
1: ETR is active at low level or falling edge.
Part of SMS for enable External clock mode 2.
In external clock mode 2, the counter is clocked by any active edge on the ETRF
signal.
0: External clock mode 2 disabled
1: External clock mode 2 enabled.
Note:
It is possible to simultaneously use external clock mode 2 with the restart mode,
pause mode or event mode(TS bits must not be 3’b111).
The external clock input will be ETRF if external clock mode 1 and external clock
mode 2 are enabled at the same time.
External clock mode 1 enable is in this register’s SMS bit-filed.
External trigger prescaler
The frequency of external trigger signal ETRP must not be at higher than 1/4 of
TIMER_CK frequency. When the external trigger signal is a fast clock, the prescaler
can be enabled to reduce ETRP frequency.
00: Prescaler disable
01: ETRF frequency will be divided by 2
10: ETRF frequency will be divided by 4
11: ETRF frequency will be divided by 8
External trigger filter control
An event counter is used in the digital filter, in which a transition on the output
occurs after N input events. This bit-field specifies the frequency used to sample
ETRP signal and the length of the digital filter applied to ETRP.
0000: Filter disabled. fSAMP= fDTS, N=1.
0001: fSAMP= fTIMER_CK, N=2.
0010: fSAMP= fTIMER_CK, N=4.
0011: fSAMP= fTIMER_CK, N=8.
0100: fSAMP=fDTS/2, N=6.
0101: fSAMP=fDTS/2, N=8.
0110: fSAMP=fDTS/4, N=6.
0111: fSAMP=fDTS/4, N=8.
1000: fSAMP=fDTS/8, N=6.
1001: fSAMP=fDTS/8, N=8.
1010: fSAMP=fDTS/16, N=5.
1011: fSAMP=fDTS/16, N=6.
1100: fSAMP=fDTS/16, N=8.
1101: fSAMP=fDTS/32, N=5.
1110: fSAMP=fDTS/32, N=6.
1111: fSAMP=fDTS/32, N=8.
Master-slave mode
This bit can be used to synchronize selected timers to begin counting at the same
time. The TRGI is used as the start event, and through TRGO, timers are connected
together.
0: Master-slave mode disable
1: Master-slave mode enable

Rev01

201

WB32FQ95xx Reference Manual

Bits

Fields

RW

Descriptions

6:4

TS[2:0]

RW

Trigger selection
This bit-field specifies which signal is selected as the trigger input, which is used to
synchronize the counter.
000: Internal trigger input 0 (ITR0)
001: Internal trigger input 1 (ITR1)
010: Internal trigger input 2 (ITR2)
011: Internal trigger input 3 (ITR3)
100: TI1 edge flag (TI1F_ED)
101: Channel 1 input Filtered output (TI1FP1)
110: Channel 2 input Filtered output (TI2FP2)
111: External trigger input filter output(ETRF)
These bits must not be changed when slave mode is enabled.

3

Reserved

R

Must be kept at reset value.

RW

Slave mode control
000: Disable mode. The slave mode is disabled; The prescaler is clocked directly by
the internal clock (TIMER_CK) when CEN bit is set high.
001: Quadrature decoder mode 0.The counter counts on TI2FP2 edge, while the
direction depends on TI1FP1 level.
010: Quadrature decoder mode 1.The counter counts on TI1FP1 edge, while the
direction depends on TI2FP2 level.
011: Quadrature decoder mode 2.The counter counts on both TI1FP1 and TI2FP2
edge, while the direction depends on each other.
100: Restart mode. The counter is reinitialized and the shadow registers are
updated on the rising edge of the selected trigger input.
101: Pause mode. The trigger input enables the counter clock when it is high and
disables the counter when it is low.
110: Event mode. A rising edge of the trigger input enables the counter. The counter
cannot be disabled by the slave mode controller.
111: External clock mode 1. The counter counts on the rising edges of the selected
trigger.

2:0

15.5.4.

SMS[2:0]

DMA and interrupt enable register (TIMx_DIER)
Address offset: 0x0C
Reset value: 0x0000

Bits

Fields

RW

31-15

Reserved

R

14

TDE

RW

13

COMDE

RW

12

CC4DE

RW

11

CC3DE

RW

Doc ID 2905025

Descriptions
Must be kept at reset value.
Trigger DMA request enable
0: disabled
1: enabled
Commutation DMA request enable
0: disabled
1: enabled
Channel 4 capture/compare DMA request enable
0: disabled
1: enabled
Channel 3 capture/compare DMA request enable
0: disabled
1: enabled

Rev01

202

WB32FQ95xx Reference Manual

Bits

Fields

RW

10

CC2DE

RW

9

CC1DE

RW

8

UDE

RW

7

BIE

RW

6

TE

RW

5

COMIE

RW

4

CC4IE

RW

3

CC3IE

RW

2

CC2IE

RW

1

CC1IE

RW

0

UIE

RW

15.5.5.

Descriptions
Channel 2 capture/compare DMA request enable
0: disabled
1: enabled
Channel 1 capture/compare DMA request enable
0: disabled
1: enabled
Update DMA request enable
0: disabled
1: enabled
Break interrupt enable
0: disabled
1: enabled
Trigger interrupt enable
0: disabled
1: enabled
commutation interrupt enable
0: disabled
1: enabled
Channel 4 capture/compare interrupt enable
0: disabled
1: enabled
Channel 3 capture/compare interrupt enable
0: disabled
1: enabled
Channel 2 capture/compare interrupt enable
0: disabled
1: enabled
Channel 1 capture/compare interrupt enable
0: disabled
1: enabled
Update interrupt enable
0: disabled
1: enabled

Interrupt flag register (TIMx_SR)
Address offset: 0x10
Reset value: 0x0000

Bits

Fields

RW

31:13

Reserved

R

12

CC4OF

RC_W0

11

CC3OF

10

CC2OF

9

CC1OF

Doc ID 2905025

Descriptions
Must be kept at reset value.

Channel 4 over capture flag
Refer to CC1OF description
Channel 3 over capture flag
RC_W0
Refer to CC1OF description
Channel 2 over capture flag
RC_W0
Refer to CC1OF description
Channel 1 over capture flag
When Channel 1 is configured in input mode, this flag is set by hardware when a
RC_W0
capture event occurs while CC1IF flag has already been set. This flag is cleared by
software.

Rev01

203

WB32FQ95xx Reference Manual

Bits

Fields

RW

Descriptions
0: No over capture interrupt occurred
1: Over capture interrupt occurred

8

Reserved

R

7

BIF

RC_W0

6

TIF

RC_W0

5

COMIF

RC_W0

4

CC4IF

RC_W0

3

CC3IF

RC_W0

2

CC2IF

RC_W0

1

CC1IF

RC_W0

0

UIF

RC_W0

15.5.6.

Must be kept at reset value.
Break interrupt flag
This flag is set by hardware when the break input goes active, and cleared by
software if the break input is not active.
0: No active level break has been detected.
1: An active level has been detected.
Trigger interrupt flag
This flag is set by hardware on trigger event and cleared by software. When the
slave mode controller is enabled in all modes but pause mode, an active edge on
trigger input generates a trigger event. When the slave mode controller is enabled
in pause mode both edges on trigger input generates a trigger event.
0: No trigger event occurred.
1: Trigger interrupt occurred.
Channel commutation interrupt flag
This flag is set by hardware when channel’s commutation event occurs, and cleared
by software
0: No channel commutation interrupt occurred
1: Channel commutation interrupt occurred
Channel 4‘s capture/compare interrupt flag
Refer to CC1IF description
Channel 3‘s capture/compare interrupt flag
Refer to CC1IF description
Channel 2‘s capture/compare interrupt flag
Refer to CC1IF description
Channel 1‘s capture/compare interrupt flag
This flag is set by hardware and cleared by software. When Channel 1 is in input
mode, this flag is set when a capture event occurs. When Channel 1 is in output
mode, this flag is set when a compare event occurs.
0: No Channel 1 interrupt occurred
1: Channel 1 interrupt occurred
Update interrupt flag
This bit is set by hardware on an update event and cleared by software.
0: No update interrupt occurred
1: Update interrupt occurred

Software event generation register (TIMx_EGR)
Address offset: 0x14
Reset value: 0x0000

Bits

Fields

RW

31:8

Reserved

R

Must be kept at reset value.

W

Break event generation
This bit is set by software and cleared by hardware automatically. When this bit is set,
the MOE bit is cleared and BIF flag is set, related interrupt or DMA transfer can occur
if enabled.
0: No generate a break event
1: Generate a break event

7

BG

Doc ID 2905025

Descriptions

Rev01

204

WB32FQ95xx Reference Manual

Bits

Fields

RW

6

TG

W

5

COMG

W

4

CC4G

W

3

CC3G

W

2

CC2G

W

1

CC1G

W

0

UG

W

15.5.7.

Descriptions
Trigger event generation
This bit is set by software and cleared by hardware automatically. When this bit is set,
the TIF flag in TIMx_SR register is set, related interrupt or DMA transfer can occur if
enabled.
0: No generate a trigger event
1: Generate a trigger event
Channel commutation event generation
This bit is set by software and cleared by hardware automatically. When this bit is set,
channel’s capture/compare control registers (CCxE, CCxNE and OCxM bits) are
updated based on the value of CCPC (in the TIMx_CR2).
0: No affect
1: Generate channel’s c/c control update event
Channel 4’s capture or compare event generation
Refer to CC1G description
Channel 3’s capture or compare event generation
Refer to CC1G description
Channel 2’s capture or compare event generation
Refer to CC1G description
Channel 1’s capture or compare event generation
This bit is set by software in order to generate a capture or compare event in Channel
1, it is automatically cleared by hardware. When this bit is set, the CC1IF flag is set,
the corresponding interrupt or DMA request is sent if enabled. In addition, if Channel
2 is configured in input mode, the current value of the counter is captured in
TIMx_CCR1 register, and the CC1OF flag is set if the CC1IF flag was already high.
0: No generate a Channel 2 capture or compare event
1: Generate a Channel 2 capture or compare event
Update event generation
This bit can be set by software, and cleared by hardware automatically. When this bit
is set, the counter is cleared if the center-aligned or up counting mode is selected,
else (down counting) it takes the auto-reload value. The prescaler counter is cleared
at the same time.
0: No generate an update event
1: Generate an update event

Channel control register 0 (TIMx_CCMR1)
Address offset: 0x18
Reset value: 0x0000
Output compare mode:

Bits

Fields

RW

31-16

-

R

15

OC2CE

RW

14:12

OC2M[2:0]

RW

11

OC2PE

RW

10

OC2FE

RW

Doc ID 2905025

Descriptions
Reserved bits
Output Compare 2 clear enable
Refer to OC1CE description
Output Compare 2 mode
Refer to OC1M description
Output Compare 2 preload enable
Refer to OC1PE description
Output Compare 2 fast enable
Refer to OC1PE description

Rev01

205

WB32FQ95xx Reference Manual

Bits

Fields

RW

9:8

CC2S[1:0]

RW

7

OC1CE

RW

6:4

OC1M[2:0]

RW

3

OC1PE

RW

2

OC1FE

RW

Doc ID 2905025

Descriptions
Capture/Compare 2 selection
This bit-field specifies the direction of the channel and the input signal selection.
This bit-field is writable only when the channel is not active. (CC2E bit in
TIMx_CCER register is reset).
00: Channel 2 is configured as output
01: Channel 2 is configured as input, IC2 is mapped on TI2
10: Channel 2 is configured as input, IC2 is mapped on TI2
11: Channel 2 is configured as input, IC2 is connected to TRC. This mode is
working only if an internal trigger input is selected through TS bits in TIMx_SMCR
register.
Output Compare 1 clear enable
When this bit is set, the O1CPRE signal is cleared when High level is detected on
ETRF input.
0: Channel 1 output compare clear disable
1: Channel 1 output compare clear enable
Output Compare 1 mode
This bit-field controls the behavior of the output reference signal O1CPRE which
drives CH1_O and CH1_ON . O1CPRE is active high, while CH1_O and CH1_ON
active level depends on CC1P and CC1NP bits.
000: Frozen. The O1CPRE signal keeps stable, independent of the comparison
between the register TIMx_CCR1 and the counter TIMx_CNT.
001: Set the channel output. O1CPRE signal is forced high when the counter
matches the output compare register TIMx_CCR1.
010: Clear the channel output. O1CPRE signal is forced low when the counter
matches the output compare register TIMx_CCR1.
011: Toggle on match. O1CPRE toggles when the counter matches the output
compare register TIMx_CCR1.
100: Force low. O1CPRE is forced low level.
101: Force high. O1CPRE is forced high level.
110: PWM mode1. When counting up, O1CPRE is high as long as the counter is
smaller than TIMx_CCR1 else low. When counting down, O1CPRE is low as long
as the counter is larger than TIMx_CCR1 else high.
111: PWM mode2. When counting up, O1CPRE is low as long as the counter is
smaller than TIMx_CCR1 else high. When counting down, O1CPRE is high as
long as the counter is larger than TIMx_CCR1 else low.
Note:
When configured in PWM mode, the O1CPRE level changes only when the output
compare mode switches from “frozen” mode to “PWM” mode or when the result of
the comparison changes.
These bits cannot be modified when LOCK [1:0] bit-filed in TIMx_BDTR register is
11 and CC1S bit-filed is 00(COMPARE MODE).
Output Compare 1 preload enable
When this bit is set, the shadow register of TIMx_CCR1 register, which updates at
each update event, will be enabled.
0: Channel 1 output compare shadow disable
1: Channel 1 output compare shadow enable
The PWM mode can be used without validating the shadow register only in single
pulse mode (OPM bit in TIMx_CR1 register is set).
This bit cannot be modified when LOCK [1:0] bit-filed in TIMx_BDTR register is 11
and CC1S bit-filed is 00.
Output Compare 1 fast enable
When this bit is set, the effect of an event on the trigger in input on the
capture/compare output will be accelerated if the channel is configured in PWM0

Rev01

206

WB32FQ95xx Reference Manual

Bits

1:0

Fields

CC1S[1:0]

RW

RW

Descriptions
or PWM1 mode. The output channel will treat an active edge on the trigger input
as a compare match, and CH1_O is set to the compare level independently from
the result of the comparison.
0: Channel 1 output quickly compare disable. The minimum delay from an edge
on the trigger input to activate CH1_O output is 5 clock cycles.
1: Channel 1 output quickly compare enable. The minimum delay from an edge on
the trigger input to activate CH1_O output is 3 clock cycles.
Capture/Compare 1 selection
This bit-field specifies the work mode of the channel and the input signal selection.
This bit-field is writable only when the channel is not active. (CC1E bit in
TIMx_CCER register is reset).
00: Channel 1 is configured as output
01: Channel 1 is configured as input, IC1 is connected to TI1FP1
10: Channel 1 is configured as input, IC1 is connected to TI2FP1
11: Channel 1 is configured as input, IC1 is connected to TRC. This mode is
working only if an internal trigger input is selected through TS bits in TIMx_SMCR
register.

Input capture mode:
Bits

Fields

RW

15:12

IC2F[3:0]

RW

11:10

IC2PSC[1:0]

RW

9:8

CC2S[1:0]

RW

7:4

IC1F[3:0]

RW

3:2

IC1PSC[1:0]

RW

1:0

CC1S[1:0]

RW

Doc ID 2905025

Descriptions
Input capture 2 filter
Refer to IC1F description
Channel 2 input capture prescaler
Refer to IC1PSC description
Capture/Compare 2 selection
Same as Output compare mode
Input capture 1 filter
An event counter is used in the digital filter, in which a transition on the output
occurs after N input events. This bit-field specifies the frequency used to sample TI1
input signal and the length of the digital filter applied to TI1.
0000: Filter disabled, fSAMP=fDTS, N=1
0001: fSAMP=fTIMER_CK, N=2
0010: fSAMP=fTIMER_CK, N=4
0011: fSAMP=fTIMER_CK, N=8
0100: fSAMP =fDTS/2, N=6
0101: fSAMP =fDTS/2, N=8
0110: fSAMP =fDTS/4, N=6
0111: fSAMP =fDTS/4, N=8
1000: fSAMP =fDTS/8, N=6
1001: fSAMP =fDTS/8, N=8
1010: fSAMP =fDTS/16, N=5
1011: fSAMP =fDTS/16, N=6
1100: fSAMP =fDTS/16, N=8
1101: fSAMP =fDTS/32, N=5
1110: fSAMP =fDTS/32, N=6
1111: fSAMP =fDTS/32, N=8
Input capture 1 prescaler
This bit-field specifies the factor of the prescaler on Channel 1 input. The prescaler
is reset when CC1E bit in TIMx_CCER register is clear.
00: Prescaler disable, capture is done on each channel input edge
01: Capture is done every 2 channel input edges
10: Capture is done every 4channel input edges
11: Capture is done every 8 channel input edges
Capture/Compare 1 Selection

Rev01

207

WB32FQ95xx Reference Manual

Bits

Fields

RW

Descriptions
Same as Output compare mode

15.5.8.

Channel control register 1 (TIMx_CCMR2)
Address offset: 0x1C
Reset value: 0x0000
Output compare mode:

Bits

Fields

RW

31-16

-

R

15

OC4CE

RW

14:12

OC4M[2:0]

RW

11

OC4PE

RW

10

OC4FE

RW

9:8

CC4S[1:0]

RW

7

OC3CE

RW

6:4

OC3M[2:0]

RW

Doc ID 2905025

Descriptions
Reserved bits
Output compare 4 clear enable
Refer to OC1CE description
Channel 4 compare output control
Refer to OC1M description
Output compare 4 preload enable
Refer to OC1PE description
Output compare 4 fast enable
Refer to OC1PE description
Capture/Compare 4 selection
This bit-field specifies the direction of the channel and the input signal selection.
This bit-field is writable only when the channel is not active. (CC4E bit in
TIMx_CCER register is reset).
00: Channel 4 is configured as output
01: Channel 4 is configured as input, IC4 is mapped on TI4
10: Channel 4 is configured as input, IC4 is mapped on TI3
11: Channel 4 is configured as input, IC4 is connected to TRC, This mode is
working only if an internal trigger input is selected through TS bits in TIMx_SMCR
register.
Output compare 3 clear enable
When this bit is set, the O3CPRE signal is cleared when High level is detected on
ETRF input.
0: Channel 3 output compare clear disable
1: Channel 3 output compare clear enable
Output compare 3 mode
This bit-field controls the behavior of the output reference signal O3CPRE which
drives CH3_O and CH3_ON . O3CPRE is active high, while CH3_O and CH3_ON
active level depends on CC3P and CC3NP bits.
000: Frozen. The O3CPRE signal keeps stable, independent of the comparison
between the output compare register TIMx_CCR3 and the counter TIMx CNT .
001: Set high on match. O3CPRE signal is forced high when the counter matches
the output compare register TIMx_CCR3.
010: Set low on match. O3CPRE signal is forced low when the counter matches the
output compare register TIMx_CCR3.
011: Toggle on match. O3CPRE toggles when the counter matches the output
compare register TIMx_CCR3.
100: Force low. O3CPRE is forced low level.
101: Force high. O3CPRE is forced high level.
110: PWM mode 1. When counting up, O3CPRE is high as long as the counter is
smaller than TIMx_CCR3 else low. When counting down, O3CPRE is low as long
as the counter is larger than TIMx_CCR3 else high.

Rev01

208

WB32FQ95xx Reference Manual

Bits

Fields

RW

3

OC3PE

RW

2

OC3FE

RW

1:0

CC3S[1:0]

RW

Descriptions
111: PWM mode 2. When counting up, O3CPRE is low as long as the counter is
smaller than TIMx_CCR3 else high. When counting down, O3CPRE is high as long
as the counter is larger than TIMx_CCR3 else low.
Note:
When configured in PWM mode, the O3CPRE level changes only when the output
compare mode switches from “frozen” mode to “PWM” mode or when the result of
the comparison changes.
This bit cannot be modified when LOCK [1:0] bit-filed in TIMx_BDTR register is 11
and CC3S bit-filed is 00(COMPARE MODE).
Output compare 3 preload enable
When this bit is set, the shadow register of TIMx_CCR3 register, which updates at
each update event will be enabled.
0: Channel 3 output compare shadow disable
1: Channel 3 output compare shadow enable
Note:
The PWM mode can be used without validating the shadow register only in single
pulse mode (OPM bit in TIMx_CR1 register is set) .
This bit cannot be modified when LOCK [1:0] bit-filed in TIMx_BDTR register is 11
and CC1S bit-filed is 00.
Output compare 3 fast enable
When this bit is set, the effect of an event on the trigger in input on the
capture/compare output will be accelerated if the channel is configured in PWM1 or
PWM2 mode. The output channel will treat an active edge on the trigger input as a
compare match, and CH3_O is set to the compare level independently from the
result of the comparison.
0: Channel 3 output quickly compare disable. The minimum delay from an edge on
the trigger input to activate CH3_O output is 5 clock cycles.
1: Channel 3 output quickly compare enable. The minimum delay from an edge on
the trigger input to activate CH3_O output is 3 clock cycles.
Capture/Compare 3 selection
This bit-field specifies the work mode of the channel and the input signal selection.
This bit-field is writable only when the channel is not active. (CC3E bit in
TIMx_CCER register is reset).).
00: Channel 3 is configured as output
01: Channel 3 is configured as input, IC3 is mapped on TI3
10: Channel 3 is configured as input, IC3 is mapped on TI4
11: Channel 3 is configured as input, IC3 is connected to TRC. This mode is
working only if an internal trigger input is selected through TS bits in TIMx_SMCR
register.

Input capture mode:
Bits

Fields

RW

15:12

IC4F[3:0]

RW

11:10

IC4PSC[1:0]

RW

9:8

CC4S[1:0]

RW

7:4

IC3F[3:0]

RW

Doc ID 2905025

Descriptions
Input capture 4 filter
Refer to IC3F description
Input capture 4 prescaler
Refer to IC3PSC description
Capture/Compare 4 selection
Same as Output compare mode
Input capture 3 filter
An event counter is used in the digital filter, in which a transition on the output
occurs after N input events. This bit-field specifies the frequency used to sample
TI3 input signal and the length of the digital filter applied to TI3.
0000: Filter disabled, fSAMP=fDTS, N=1

Rev01

209

WB32FQ95xx Reference Manual

Bits

Fields

RW

3:2

IC3PSC[1:0]

RW

1:0

CC3S[1:0]

RW

15.5.9.

Descriptions
0001: fSAMP=fTIMER_CK, N=2
0010: fSAMP=fTIMER_CK, N=4
0011: fSAMP=fTIMER_CK, N=8
0100: fSAMP =fDTS/2, N=6
0101: fSAMP =fDTS/2, N=8
0110: fSAMP =fDTS/4, N=6
0111: fSAMP =fDTS/4, N=8
1000: fSAMP =fDTS/8, N=6
1001: fSAMP =fDTS/8, N=8
1010: fSAMP =fDTS/16, N=5
1011: fSAMP =fDTS/16, N=6
1100: fSAMP =fDTS/16, N=8
1101: fSAMP =fDTS/32, N=5
1110: fSAMP =fDTS/32, N=6
1111: fSAMP =fDTS/32, N=8
Input capture 3 prescaler
This bit-field specifies the factor of the prescaler on Channel 3 input. The
prescaler is reset when CC3E bit in TIMx_CCER register is clear.
00: Prescaler disable, capture is done on each channel input edge
01: Capture is done every 2 channel input edges
10: Capture is done every 4 channel input edges
11: Capture is done every 8 channel input edges
Capture/compare 3 selection
Same as Output compare mode

Channel control register 2 (TIMx_CCER)
Address offset: 0x20
Reset value: 0x0000

Bits

Fields

RW

31:14

Reserved

R

13

CC4P

RW

12

CC4E

RW

11

CC3NP

RW

10

CC3NE

RW

9

CC3P

RW

8

CC3E

RW

7

CC2NP

RW

6

CC2NE

RW

5

CC2P

RW

4

CC2E

RW

Doc ID 2905025

Descriptions
Must be kept at reset value
Channel 4 capture/compare function polarity
Refer to CC1P description
Channel 4 capture/compare function enable
Refer to CC1E description
Channel 3 complementary output polarity
Refer to CC1NP description
Channel 3 complementary output enable
Refer to CC1NE description
Channel 3 capture/compare function polarity
Refer to CC1P description
Channel 3 capture/compare function enable
Refer to CC1E description
Channel 2 complementary output polarity
Refer to CC1NP description
Channel 2 complementary output enable
Refer to CC1NE description
Channel 2 capture/compare function polarity
Refer to CC1P description
Channel 2 capture/compare function enable
Refer to CC1E description

Rev01

210

WB32FQ95xx Reference Manual

Bits

Fields

RW

3

CC1NP

RW

2

CC1NE

RW

1

CC1P

RW

0

CC1E

RW

15.5.10.

Descriptions
Channel 1 complementary output polarity
When Channel 1 is configured in output mode, this bit specifies the complementary
output signal polarity.
0: Channel 1 active high
1: Channel 1 active low
Note: This bit cannot be modified when LOCK [1:0] bit-filed in TIMx_BDTR register
is 11 or 10 and CC1S [1:0] bit-filed in TIMx_CCMR1 register is 00 .
Channel 1 complementary output enable
When Channel 1 is configured in output mode, setting this bit enables the
complementary output in channel0.
0: Channel 1 complementary output disabled
1: Channel 1 complementary output enabled
Channel 1 capture/compare function polarity
When Channel 1 is configured in output mode, this bit specifies the output signal
polarity.
0: Channel 1 active high
1: Channel 1 active low
When Channel 1 is configured in input mode, this bit specifies the TI1 signal
polarity.
0: TI1 is non-inverted. Input capture is done on a rising edge of TI1. When used as
extern trigger, TI1 is non-inverted.
1: TI1 is inverted. Input capture is done on a falling edge of TI1. When used as
extern trigger, TI1 is inverted.
Note: This bit cannot be modified when LOCK [1:0] bit-filed in TIMx_BDTR register
is 11 or 10.
Channel 1 capture/compare function enable
When Channel 1 is configured in output mode, setting this bit enables CH1_O
signal in active state. When Channel 1 is configured in input mode, setting this bit
enables the capture event in channel0.
0: Channel 1 disabled
1: Channel 1 enabled

Counter register (TIMx_CNT)
Address offset: 0x24
Reset value: 0x0000

Bits

Fields

RW

31-20

-

R

Reserved bits

19:0

CNT[19:0]

RW

This bit-filed indicates the current counter value. Writing to this bit-filed can change
the value of the counter.

15.5.11.

Descriptions

Prescaler register (TIMx_PSC)
Address offset: 0x28
Reset value: 0x0000

Bits

Fields

RW

31:16

-

R

Reserved bits

RW

Prescaler value of the counter clock
The PSC clock is divided by (PSC+1) to generate the counter clock. The value of
this bit-filed will be loaded to the corresponding shadow register at every update
event.

15:0

PSC[15:0]

Doc ID 2905025

Descriptions

Rev01

211

WB32FQ95xx Reference Manual

15.5.12.

Counter auto reload register (TIMx_ARR)
Address offset: 0x2C
Reset value: 0x0000

Bits

Fields

RW

31:20

-

R

Reserved bits

RW

Counter auto reload value
This bit-filed specifies the auto reload value of the counter.
Note: When the timer is configured in input capture mode, this register must be
configured a non-zero value (such as 0xFFFF) which is larger than user expected
value.

19:0

15.5.13.

ARR[19:0]

Descriptions

Counter repetition register (TIMx_RCR)
Address offset: 0x30
Reset value: 0x0000

Bits

Fields

RW

31:8

Reserved

R

Must be kept at reset value.

RW

Counter repetition value
This bit-filed specifies the update event generation rate. Each time the repetition
counter counting down to zero, an update event is generated. The update rate of the
shadow registers is also affected by this bit-filed when these shadow registers are
enabled.

7:0

15.5.14.

REP[7:0]

Descriptions

Channel 1 capture/compare value register (TIMx_CCR1)
Address offset: 0x34
Reset value: 0x0000

Bits

Fields

RW

31:20

-

R

Reserved bits

RW

Capture or compare value of channel0
When Channel 1 is configured in input mode, this bit-filed indicates the counter
value corresponding to the last capture event. And this bit-filed is read-only.
When Channel 1 is configured in output mode, this bit-filed contains value to be
compared to the counter. When the corresponding shadow register is enabled,
the shadow register updates every update event.

19:0

15.5.15.

CCR1[19:0]

Descriptions

Channel 2 capture/compare value register (TIMx_CCR2)
Address offset: 0x38
Reset value: 0x0000

Bits

Fields

RW

31:20

-

R

Reserved bits

19:0

CCR2[19:0]

RW

Capture or compare value of channel1
When Channel 2 is configured in input mode, this bit-filed indicates the counter

Doc ID 2905025

Descriptions

Rev01

212

WB32FQ95xx Reference Manual

Bits

Fields

RW

Descriptions
value corresponding to the last capture event. And this bit-filed is read-only.
When Channel 2 is configured in output mode, this bit-filed contains value to be
compared to the counter. When the corresponding shadow register is enabled,
the shadow register updates every update event.

15.5.16.

Channel 3 capture/compare value register (TIMx_CCR3)
Address offset: 0x3C
Reset value: 0x0000

Bits

Fields

RW

31:20

-

R

Reserved bits

RW

Capture or compare value of Channel 3
When Channel 3 is configured in input mode, this bit-filed indicates the counter
value corresponding to the last capture event. And this bit-filed is read-only. When
Channel 3 is configured in output mode, this bit-filed contains value to be
compared to the counter. When the corresponding shadow register is enabled,
the shadow register updates every update event.

19:0

15.5.17.

CCR3[19:0]

Descriptions

Channel 4 capture/compare value register (TIMx_CCR4)
Address offset: 0x40
Reset value: 0x0000

Bits

Fields

RW

31:20

-

R

Reserved bits

RW

Capture or compare value of Channel 4
When channel4 is configured in input mode, this bit-filed indicates the counter
value corresponding to the last capture event. And this bit-filed is read-only.
When Channel 4 is configured in output mode, this bit-filed contains value to be
compared to the counter. When the corresponding shadow register is enabled,
the shadow register updates every update event.

19:0

15.5.18.

CCR4[19:0]

Descriptions

Complementary channel protection register (TIMx_BDTR)
Address offset: 0x44
Reset value: 0x0000

Bits

Fields

RW

31:16

-

R

Descriptions
Reserved bits
Main output enable
This bit s set by software or automatically by hardware depending on the AOE bit.
It is cleared asynchronously by hardware as soon as the break input is active.

15

MOE

RW

When one of channels is configured in output mode, setting this bit enables the
channel outputs (CHx_O and CHx_ON) if the corresponding enable bits (CCxE,
CCxNE in TIMx_CCER register) have been set.
0: Channel outputs are disabled or forced to idle state.
1: Channel outputs are enabled.

Doc ID 2905025

Rev01

213

WB32FQ95xx Reference Manual

Bits

Fields

RW

Descriptions
Automatic output enable
This bit specifies whether the MOE bit can be set automatically by hardware.
0: MOE can be not set by hardware.

14

AOE

RW

1: MOE can be set by hardware automatically at the next update event, if the
break input is not active.
Note: This bit can be modified only when LOCK [1:0] bit-filed in TIMx_BDTR
register is 00.
Break polarity

13

BKP

RW

This bit specifies the polarity of the BRKIN input signal.
0: BRKIN input active low
1: BRKIN input active high
Break enable
This bit can be set to enable the BRKIN and CKM clock failure event inputs.

12

BKE

RW

0: Break inputs disabled
1: Break inputs enabled
Note: This bit can be modified only when LOCK [1:0] bit-filed in TIMx_BDTR
register is 00.
Off-state selection for Run mode
When MOE bit is set, this bit specifies the output state for the channels which
has a complementary output and has been configured in output mode.
0: When MOE bit is set, the channel output signals (CHx_O/CHx_ON) are

11

OSSR

RW

disabled.
1: When MOE bit is set, the channel output signals (CHx_O/CHx_ON) are
enabled, with relationship to CCxE/CCxNE bits in TIMx_CCER register.
Note: This bit cannot be modified when LOCK [1:0] bit-filed in TIMx_BDTR
register is 10 or 11.
Off-state selection for Idle mode
When MOE bit is reset, this bit specifies the output state for the channels which
has been configured in output mode.
0: When MOE bit is reset, the channel output signals (CHx_O/CHx_ON) are

10

OSSI

RW

disabled.
1: When MOE bit is reset, he channel output signals (CHx_O/CHx_ON) are
enabled, with relationship to CCxE/CCxNE bits in TIMx_CCER register.
Note: This bit cannot be modified when LOCK [1:0] bit-filed in TIMx_BDTR
register is 10 or 11.
Lock configuration
This bit-filed specifies the write protection property of registers.
00: protect disable. No write protection.
01: LOCK mode 0.The ISOx/ISOxN bits in TIMx_CR2 register and the

9:8

LOCK[1:0]

RW

BKE/BKP/AOE/DTG bits in TIMx_BDTR register are writing

protected.

10: LOCK mode 1. In addition of the registers in LOCK mode 0, the CCxP/CCxNP
bits in TIMx_CCER register (if related channel is configured in output mode) and
the OSSR/OSSI bits in TIMx_BDTR register are writing protected.
11: LOCK mode 2. In addition of the registers in LOCK mode 1, the OCxM/
OCxPE bits in TIMx_CCMR1/1 registers (if the related channel is configured in

Doc ID 2905025

Rev01

214

WB32FQ95xx Reference Manual

Bits

Fields

RW

Descriptions
output) are writing protected.
Note: This bit-field can be written only once after the reset. Once the TIMx_BDTR
register has been written, this bit-field will be writing protected.
Dead time configure
This bit-field controls the value of the dead-time, which is inserted before the
output transitions. The relationship between DTG value and the duration of
dead-time is as follow:

7:0

DTG[7:0]

RW

DTG [7:5] =3’b0xx: DTvalue = DTG [7:0] * tDT, tDT = tDTS.
DTG [7:5] =3’b10x: DTvalue = (64+DTG [5:0]) * tDT, tDT = tDTS * 2.
DTG [7:5] =3’b110: DTvalue = (32+DTG [4:0]) * tDT, tDT = tDTS * 8.
DTG [7:5] =3’b111: DTvalue = (32+DTG [4:0]) * tDT, tDT = tDTS * 16.
Note: This bit can be modified only when LOCK [1:0] bit-filed in TIMx_BDTR
register is 00.

Doc ID 2905025

Rev01

215

